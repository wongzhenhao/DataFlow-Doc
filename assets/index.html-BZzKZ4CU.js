import{_ as i,c as a,b as n,o as l}from"./app-GpZKBnvo.js";const t={};function e(h,s){return l(),a("div",null,s[0]||(s[0]=[n(`<h2 id="æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#æ¦‚è¿°"><span>æ¦‚è¿°</span></a></h2><p>å¼ºæ¨ç†ç®—å­æ˜¯ä¸“é—¨ç”¨äºæ•°å­¦æ¨ç†å’Œé—®é¢˜æ±‚è§£çš„ç®—å­é›†åˆï¼Œä¸»è¦åˆ†ä¸ºä¸‰å¤§ç±»ï¼š<strong>æ•°æ®ç”Ÿæˆç®—å­ï¼ˆGeneratorï¼‰</strong> ã€<strong>è¿‡æ»¤ç®—å­ï¼ˆFilterï¼‰<strong>å’Œ</strong>æ”¹å†™ç®—å­ï¼ˆRefinerï¼‰</strong>ã€‚è¿™äº›ç®—å­èƒ½å¤Ÿå¤„ç†å¤æ‚çš„æ•°å­¦æ¨ç†ä»»åŠ¡ï¼ŒåŒ…æ‹¬ç­”æ¡ˆç”Ÿæˆã€éªŒè¯ã€è¿‡æ»¤å’Œæ ¼å¼åŒ–ç­‰åŠŸèƒ½ï¼ŒåŒæ—¶æ”¯æŒå¤šç§æ•°å­¦è¡¨ç¤ºæ ¼å¼ã€‚</p><p>å¼€æºçš„ç®—å­ç§ç±»æ˜¯ååˆ†å—é™çš„ï¼Œä¸ºäº†è·å¾—æ›´å¥½çš„æ•°æ®å¤„ç†è´¨é‡ï¼Œå¡«è¡¥å¼€æºç¼ºå¤±çš„æ•°æ®åˆæˆä¸å¤„ç†æ–¹æ³•ï¼Œæˆ‘ä»¬ç²¾å¿ƒè®¾è®¡å¹¶<strong>è‡ªç ”</strong>äº†æ–°çš„ç®—å­é›†ï¼Œå…¶æ ‡è®°å«ä¹‰å¦‚ä¸‹ï¼š</p><ul><li>ğŸš€ <strong>è‡ªä¸»åˆ›æ–°</strong>ï¼šæ ¸å¿ƒç®—æ³•åŸåˆ›ç ”å‘ï¼Œå¡«è¡¥ç°æœ‰ç®—æ³•ç©ºç™½æˆ–æ˜¯è¿›ä¸€æ­¥æå‡æ€§èƒ½ï¼Œçªç ´å½“ä¸‹æ€§èƒ½ç“¶é¢ˆã€‚</li><li>âœ¨ <strong>å¼€æºé¦–å‘</strong>ï¼šé¦–æ¬¡å°†è¯¥ç®—å­é›†æˆåˆ°ç¤¾åŒºä¸»æµæ¡†æ¶ä¸­ï¼Œæ–¹ä¾¿æ›´å¤šå¼€å‘è€…ä½¿ç”¨ï¼Œå®ç°å¼€æºå…±äº«ã€‚</li></ul><h2 id="æ•°æ®ç”Ÿæˆç®—å­" tabindex="-1"><a class="header-anchor" href="#æ•°æ®ç”Ÿæˆç®—å­"><span>æ•°æ®ç”Ÿæˆç®—å­</span></a></h2><p>æ•°æ®ç”Ÿæˆå™¨ä¸»è¦è´Ÿè´£ç”Ÿæˆå„ç±»æ¨ç†ç›¸å…³çš„æ•°æ®ï¼ŒåŒ…æ‹¬ç­”æ¡ˆç”Ÿæˆã€é—®é¢˜ç”Ÿæˆç­‰ã€‚</p><table class="tg"><thead><tr><th class="tg-0pky">åç§°</th><th class="tg-0pky">é€‚ç”¨ç±»å‹</th><th class="tg-0pky">ç®€ä»‹</th><th class="tg-0pky">å®˜æ–¹ä»“åº“æˆ–è®ºæ–‡</th></tr></thead><tbody><tr><td class="tg-0pky">ReasoningAnswerGeneratorâœ¨</td><td class="tg-0pky">ç­”æ¡ˆåˆæˆ</td><td class="tg-0pky">è¯¥ç®—å­ç”¨äºç”Ÿæˆæ•°å­¦é—®é¢˜çš„æ ‡å‡†ç­”æ¡ˆï¼Œè°ƒç”¨å¤§è¯­è¨€æ¨¡å‹è¿›è¡Œåˆ†æ­¥æ¨ç†å’Œè®¡ç®—ã€‚</td><td class="tg-0pky"><a href="https://arxiv.org/abs/2410.01560">Paper</a></td></tr><tr><td class="tg-0pky">ReasoningPseudoAnswerGeneratorâœ¨</td><td class="tg-0pky">ä¼ªç­”æ¡ˆç”Ÿæˆä¸æŠ•ç¥¨</td><td class="tg-0pky">è¯¥ç®—å­ç”Ÿæˆå¤šä¸ªå€™é€‰ç­”æ¡ˆå¹¶é€šè¿‡ç»Ÿè®¡é€‰æ‹©æœ€ä¼˜è§£ï¼Œå®ç°ä¼ªç­”æ¡ˆç”Ÿæˆã€‚</td><td class="tg-0pky"><a href="https://arxiv.org/abs/2410.01560">Paper</a></td></tr><tr><td class="tg-0pky">ReasoningQuestionGeneratorâœ¨ğŸš€</td><td class="tg-0pky">é—®é¢˜ç”Ÿæˆ</td><td class="tg-0pky">è¯¥ç®—å­ç”¨äºåŸºäºç°æœ‰é—®é¢˜ç”Ÿæˆæ–°é—®é¢˜ï¼Œæ”¯æŒå¤šç§ç”Ÿæˆç­–ç•¥ä»¥ä¿è¯å¤šæ ·æ€§ã€‚</td><td class="tg-0pky">-</td></tr><tr><td class="tg-0pky">ReasoningPretrainFormatConvertGeneratorâœ¨</td><td class="tg-0pky">æ ¼å¼è½¬æ¢</td><td class="tg-0pky">å°†SFTæ ¼å¼æ•°æ®è½¬æ¢ä¸ºé¢„è®­ç»ƒæ ¼å¼ï¼Œæ”¯æŒè‡ªå®šä¹‰è¾“å…¥è¾“å‡ºé”®é…ç½®</td><td class="tg-0pky">-</td></tr><tr><td class="tg-0pky">ReasoningQuestionCategorySampleEvaluatorâœ¨ğŸš€</td><td class="tg-0pky">é—®é¢˜åˆ†ç±»</td><td class="tg-0pky">å¯¹ç”¨æˆ·é—®é¢˜è¿›è¡Œå¤šçº§åˆ†ç±»ï¼Œä¾æ®è®¾è®¡å¹¶æ”¹è¿›åçš„MSCæ•°å­¦åˆ†ç±»æ ‡å‡†</td><td class="tg-0pky">-</td></tr><tr><td class="tg-0pky">ReasoningQuestionDifficultySampleEvaluatorâœ¨</td><td class="tg-0pky">éš¾åº¦è¯„ä¼°</td><td class="tg-0pky">è¯„ä¼°é—®é¢˜éš¾åº¦ç­‰çº§ï¼Œè¾“å‡º1-10çº§ç»†ç²’åº¦éš¾åº¦è¯„åˆ†</td><td class="tg-0pky"><a href="https://arxiv.org/abs/2410.07985">Paper</a></td></tr><tr><td class="tg-0pky">ReasoningAnswerExtractionQwenMathEvalGeneratorâœ¨</td><td class="tg-0pky">ç­”æ¡ˆæå–ä¸æ ‡å‡†åŒ–</td><td class="tg-0pky">ä»æ•°å­¦é—®é¢˜å›ç­”ä¸­æå–è§„èŒƒåŒ–ç­”æ¡ˆè¡¨è¾¾å¼ï¼Œæ”¯æŒå•ä½å¤„ç†å’Œæ ¼å¼è½¬æ¢</td><td class="tg-0pky"><a href="https://github.com/QwenLM/Qwen2.5-Math">Code</a></td></tr></tbody></table><h2 id="å¤„ç†ç®—å­" tabindex="-1"><a class="header-anchor" href="#å¤„ç†ç®—å­"><span>å¤„ç†ç®—å­</span></a></h2><p>å¤„ç†ç®—å­ä¸»è¦è´Ÿè´£å¯¹ç”Ÿæˆçš„æ•°æ®è¿›è¡Œå¤„ç†ã€éªŒè¯ã€è¿‡æ»¤å’Œæ ¼å¼åŒ–ç­‰æ“ä½œã€‚</p><table class="tg"><thead><tr><th class="tg-0pky">åç§°</th><th class="tg-0pky">é€‚ç”¨ç±»å‹</th><th class="tg-0pky">ç®€ä»‹</th><th class="tg-0pky">å®˜æ–¹ä»“åº“æˆ–è®ºæ–‡</th></tr></thead><tbody><tr><td class="tg-0pky">ReasoningAnswerFormatterFilter</td><td class="tg-0pky">æ ¼å¼éªŒè¯</td><td class="tg-0pky">è¯¥ç®—å­ç”¨äºæ£€æŸ¥ç­”æ¡ˆæ ¼å¼æ˜¯å¦ç¬¦åˆè§„èŒƒï¼Œä¸»è¦éªŒè¯æ•°å­¦ç­”æ¡ˆæ˜¯å¦åŒ…å«æ­£ç¡®çš„\\\\boxed{}æ ‡è®°ã€‚</td><td class="tg-0pky">-</td></tr><tr><td class="tg-0pky">ReasoningAnswerGroundTruthFilterâœ¨</td><td class="tg-0pky">æ ‡å‡†ç­”æ¡ˆåŒ¹é…</td><td class="tg-0pky">è¯¥ç®—å­ç”¨äºå¯¹æ¯”é¢„æµ‹ç­”æ¡ˆä¸æ ‡å‡†ç­”æ¡ˆçš„åŒ¹é…åº¦ï¼Œæ”¯æŒç²¾ç¡®åŒ¹é…å’Œæ•°å­¦éªŒè¯ä¸¤ç§æ–¹å¼ã€‚</td><td class="tg-0pky">-</td></tr><tr><td class="tg-0pky">ReasoningAnswerJudgeMathVerifyFilterâœ¨</td><td class="tg-0pky">æ•°å­¦ç­”æ¡ˆéªŒè¯</td><td class="tg-0pky">è¯¥ç®—å­é€šè¿‡ç¬¦å·è®¡ç®—éªŒè¯ç­”æ¡ˆæ­£ç¡®æ€§ï¼Œæ‰§è¡Œæ•°å­¦è¡¨è¾¾å¼è§£æå’Œç­‰ä»·æ€§éªŒè¯ã€‚</td><td class="tg-0pky"><a href="https://github.com/huggingface/Math-Verify">Code</a></td></tr><tr><td class="tg-0pky">ReasoningAnswerNgramFilterâœ¨</td><td class="tg-0pky">é‡å¤æ£€æµ‹</td><td class="tg-0pky">è¯¥ç®—å­åŸºäºn-gramé‡å¤ç‡è¿‡æ»¤ç­”æ¡ˆï¼Œæ£€æµ‹å›ç­”ä¸­çš„é‡å¤æ¨¡å¼å’Œå†—ä½™å†…å®¹ã€‚</td><td class="tg-0pky"><a href="https://en.wikipedia.org/wiki/N-gram">Wiki</a></td></tr><tr><td class="tg-0pky">ReasoningAnswerPipelineRootFilterâœ¨</td><td class="tg-0pky">æ ‡å‡†ç­”æ¡ˆå­˜åœ¨æ€§åˆ†ç±»å™¨</td><td class="tg-0pky">ç­”æ¡ˆå¤„ç†æµç¨‹æ ¹èŠ‚ç‚¹ï¼Œè´Ÿè´£å°†è¾“å…¥æ•°æ®æ ¹æ®æœ‰æ— çœŸå®æ ‡ç­¾GTåˆ†å‘åˆ°ä¸åŒå¤„ç†åˆ†æ”¯ã€‚</td><td class="tg-0pky">-</td></tr><tr><td class="tg-0pky">ReasoningAnswerTokenLengthFilter</td><td class="tg-0pky">é•¿åº¦æ§åˆ¶</td><td class="tg-0pky">è¯¥ç®—å­æ ¹æ®tokenæ•°é‡è¿‡æ»¤è¿‡é•¿çš„ç­”æ¡ˆï¼Œç¡®ä¿ç­”æ¡ˆé•¿åº¦åœ¨åˆç†èŒƒå›´å†…ã€‚</td><td class="tg-0pky">-</td></tr><tr><td class="tg-0pky">ReasoningQuestionFilterâœ¨ğŸš€</td><td class="tg-0pky">é—®é¢˜éªŒè¯</td><td class="tg-0pky">è¯¥ç®—å­ç”¨äºå¯¹æ•°å­¦é—®é¢˜è¿›è¡Œæ­£ç¡®æ€§æ£€æŸ¥ï¼ŒåŒ…æ‹¬æ ¼å¼è§„èŒƒã€è¯­ä¹‰åˆç†æ€§ã€æ¡ä»¶ä¸€è‡´æ€§ç­‰ã€‚</td><td class="tg-0pky"><a href="https://github.com/scuuy/MathQ-Verify">Code</a></td></tr></tbody></table><h2 id="ç®—å­æ¥å£è°ƒç”¨è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#ç®—å­æ¥å£è°ƒç”¨è¯´æ˜"><span>ç®—å­æ¥å£è°ƒç”¨è¯´æ˜</span></a></h2><p>ç‰¹åˆ«åœ°ï¼Œå¯¹äºæŒ‡å®šå­˜å‚¨è·¯å¾„ç­‰æˆ–æ˜¯è°ƒç”¨æ¨¡å‹çš„ç®—å­ï¼Œæˆ‘ä»¬æä¾›äº†å°è£…åçš„<strong>æ¨¡å‹æ¥å£</strong>ä»¥åŠ<strong>å­˜å‚¨å¯¹è±¡æ¥å£</strong>ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¸ºç®—å­è¿›è¡Œæ¨¡å‹APIå‚æ•°é¢„å®šä¹‰ï¼š</p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> dataflow</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">llmserving </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> APILLMServing_request</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">api_llm_serving </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> APILLMServing_request</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">                api_url</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">your_api_url</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">                model_name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">model_name</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">                max_workers</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">5</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">        )</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¸ºç®—å­è¿›è¡Œå­˜å‚¨å‚æ•°é¢„å®šä¹‰ï¼š</p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> dataflow</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">utils</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> FileStorage</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> self</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> FileStorage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">            first_entry_file_name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">your_file_path</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">            cache_path</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">./cache</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">            file_name_prefix</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">dataflow_cache_step</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">            cache_type</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">jsonl</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # jsonl, json, ...</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">        )</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åæ–‡ä½¿ç”¨çš„<code>api_llm_serving</code>ä»¥åŠ<code>self.storage</code>å³ä¸ºæ­¤å¤„å·²å®šä¹‰çš„æ¥å£å¯¹è±¡ï¼Œå®Œæ•´è°ƒç”¨ç¤ºä¾‹å¯å‚è€ƒ<code>test/test_reasoning.py</code>ã€‚</p><p>å¯¹äºä¼ å‚ï¼Œç®—å­å¯¹è±¡çš„æ„é€ å‡½æ•°ä¸»è¦ä¼ é€’ä¸ç®—å­é…ç½®ç›¸å…³çš„ä¿¡æ¯ï¼Œé…ç½®åå¯ä»¥ä¸€é…ç½®å¤šè°ƒç”¨ï¼›è€Œ<code>X.run()</code>å‡½æ•°ä¼ é€’ä¸IOç›¸å…³çš„<code>key</code>ä¿¡æ¯ï¼Œè¯¦ç»†å¯è§åæ–‡ç®—å­è¯´æ˜ç¤ºä¾‹ã€‚</p><h2 id="è¯¦ç»†ç®—å­è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#è¯¦ç»†ç®—å­è¯´æ˜"><span>è¯¦ç»†ç®—å­è¯´æ˜</span></a></h2><h3 id="_1-reasoninganswergeneratorâœ¨" tabindex="-1"><a class="header-anchor" href="#_1-reasoninganswergeneratorâœ¨"><span>1. ReasoningAnswerGeneratorâœ¨</span></a></h3><p><strong>åŠŸèƒ½æè¿°ï¼š</strong> è¯¥ç®—å­ä¸“é—¨ç”¨äºç”Ÿæˆæ•°å­¦é—®é¢˜çš„æ ‡å‡†ç­”æ¡ˆï¼Œé€šè¿‡è°ƒç”¨å¤§è¯­è¨€æ¨¡å‹è¿›è¡Œåˆ†æ­¥æ¨ç†å’Œç²¾ç¡®è®¡ç®—ã€‚</p><p><strong>è¾“å…¥å‚æ•°ï¼š</strong></p><ul><li><code>__init__()</code><ul><li><code>llm_serving</code>ï¼šä½¿ç”¨çš„å¤§è¯­è¨€æ¨¡å‹æ¥å£å¯¹è±¡ï¼ˆé»˜è®¤ï¼šå‰æ–‡é¢„è®¾å€¼ï¼‰</li><li><code>prompt_template</code>ï¼šç”Ÿæˆé—®é¢˜çš„æç¤ºæ¨¡æ¿å¯¹è±¡ï¼ˆä¾‹å¦‚<code>GeneralAnswerGeneratorPrompt()</code>ï¼‰</li></ul></li><li><code>run()</code><ul><li><code>storage</code>ï¼šå­˜å‚¨æ¥å£å¯¹è±¡ï¼ˆé»˜è®¤ï¼šå‰æ–‡é¢„è®¾å€¼ï¼‰</li><li><code>input_key</code>ï¼šè¾“å…¥é—®é¢˜å­—æ®µåï¼ˆé»˜è®¤ï¼š&quot;question&quot;ï¼‰</li><li><code>output_key</code>ï¼šè¾“å‡ºç­”æ¡ˆå­—æ®µåï¼ˆé»˜è®¤ï¼š&quot;generated_answer&quot;ï¼‰</li></ul></li></ul><p><strong>ä¸»è¦ç‰¹æ€§ï¼š</strong></p><ul><li>æ”¯æŒå¤šç§æ•°å­¦é—®é¢˜ç±»å‹ï¼ˆä»£æ•°ã€å‡ ä½•ã€æ¦‚ç‡ç»Ÿè®¡ç­‰ï¼‰</li><li>é‡‡ç”¨é“¾å¼æ€ç»´ï¼ˆChain-of-Thoughtï¼‰æ¨ç†æ–¹æ³•</li><li>è‡ªåŠ¨ç”Ÿæˆè¯¦ç»†çš„è§£é¢˜æ­¥éª¤</li><li>æ”¯æŒå¤šè½®æ¨ç†å’ŒéªŒè¯</li></ul><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong></p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> dataflow</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">prompts</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">reasoning</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">general </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> GeneralAnswerGeneratorPrompt</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">answer_gen </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ReasoningAnswerGenerator</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">          llm_serving</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">api_llm_serving</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">          prompt_template</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">GeneralAnswerGeneratorPrompt</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">          )</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">result </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> answer_gen</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">run</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">          storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">step</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(),</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">          input_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">question</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">          output_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">generated_answer</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">          )</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-reasoningpseudoanswergeneratorâœ¨" tabindex="-1"><a class="header-anchor" href="#_2-reasoningpseudoanswergeneratorâœ¨"><span>2. ReasoningPseudoAnswerGeneratorâœ¨</span></a></h3><p><strong>åŠŸèƒ½æè¿°ï¼š</strong> è¯¥ç®—å­é€šè¿‡ç”Ÿæˆå¤šä¸ªå€™é€‰ç­”æ¡ˆå¹¶ä½¿ç”¨ç»Ÿè®¡æ–¹æ³•é€‰æ‹©æœ€ä¼˜è§£ï¼Œå®ç°é«˜è´¨é‡çš„ä¼ªç­”æ¡ˆç”Ÿæˆã€‚</p><p><strong>è¾“å…¥å‚æ•°ï¼š</strong></p><ul><li><p><code>__init__()</code></p><ul><li><code>llm_serving</code>ï¼šç”¨äºç”Ÿæˆå€™é€‰ç­”æ¡ˆçš„ LLMServingABC å®ä¾‹ï¼ˆé»˜è®¤å€¼ï¼šNoneï¼‰</li><li><code>max_times</code>ï¼šæ‰§è¡Œç”Ÿæˆè½®æ¬¡çš„æœ€å¤§æ¬¡æ•°ï¼ˆé»˜è®¤å€¼ï¼š3ï¼‰</li></ul></li><li><p><code>run()</code></p><ul><li><code>storage</code>ï¼šç”¨äºè¯»å–è¾“å…¥ DataFrame å¹¶å†™å…¥è¾“å‡ºçš„ DataFlowStorage æ¥å£</li><li><code>input_key</code>ï¼šDataFrame ä¸­åŒ…å«è¾“å…¥é—®é¢˜çš„åˆ—åï¼ˆé»˜è®¤å€¼ï¼š&quot;instruction&quot;ï¼‰</li><li><code>output_key_answer</code>ï¼šç”¨äºå­˜å‚¨æ¯è¡Œæ‰€æœ‰ç”Ÿæˆç­”æ¡ˆåˆ—è¡¨çš„åˆ—åï¼ˆé»˜è®¤å€¼ï¼š&quot;pseudo_answers&quot;ï¼‰</li><li><code>output_key_answer_value</code>ï¼šç”¨äºå­˜å‚¨æ¯è¡Œæœ€ç»ˆé€‰æ‹©çš„ç­”æ¡ˆå€¼çš„åˆ—åï¼ˆé»˜è®¤å€¼ï¼š&quot;pseudo_answer_value&quot;ï¼‰</li><li><code>output_key_solutions</code>ï¼šç”¨äºå­˜å‚¨æ‰€æœ‰ä¸æ‰€é€‰ç­”æ¡ˆåŒ¹é…çš„è§£å†³æ–¹æ¡ˆæ–‡æœ¬çš„åˆ—åï¼ˆé»˜è®¤å€¼ï¼š&quot;pseudo_solutions&quot;ï¼‰</li><li><code>output_key_correct_solution_example</code>ï¼šç”¨äºå­˜å‚¨å•ä¸ªç¤ºä¾‹è§£å†³æ–¹æ¡ˆæ–‡æœ¬çš„åˆ—åï¼ˆé»˜è®¤å€¼ï¼š&quot;pseudo_correct_solution_example&quot;ï¼‰</li></ul></li></ul><p><strong>ä¸»è¦åŠŸèƒ½ï¼š</strong></p><ul><li>å¯é…ç½®çš„å¤šè½®ç­”æ¡ˆç”Ÿæˆï¼ˆ<code>max_times</code>ï¼‰</li><li>é€šè¿‡ <code>StringCleaner</code>ã€<code>UnitTextManager</code> å’Œ <code>AnswerExtractor</code> æ¸…æ´—å¹¶æå–ç­”æ¡ˆ</li><li>ä½¿ç”¨ <code>collections.Counter</code> æŒ‰é¢‘æ¬¡è®¡æ•°é€‰æ‹©æœ€ç»ˆç­”æ¡ˆ</li><li>è®°å½•æ¯è½®ç”Ÿæˆè¿›åº¦å¹¶è¿‡æ»¤æ‰æ— æ•ˆç­”æ¡ˆçš„è¡Œ</li><li>è¿”å›å››ä¸ªè¾“å‡ºåˆ—é”®çš„åˆ—è¡¨ä»¥ä¾›åç»­å¤„ç†</li></ul><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong></p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> dataflow</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">prompts</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">reasoning </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> AnswerGeneratorPrompt</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> dataflow</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">core </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> LLMServingABC</span></span>
<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> dataflow</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">utils</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> DataFlowStorage</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># Prepare LLM serving and storage</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">api_llm_serving </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> YourLLMServingImplementation</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> DataFlowStorage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">...</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># Instantiate the pseudo-answer generator</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">pseudo_gen </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ReasoningPseudoAnswerGenerator</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    llm_serving</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">api_llm_serving</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    max_times</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">5</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># Run it on a DataFrame stored in &#39;storage&#39;</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">result_keys </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> pseudo_gen</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">run</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    input_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">instruction</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    output_key_answer</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">pseudo_answers</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    output_key_answer_value</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">pseudo_answer_value</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    output_key_solutions</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">pseudo_solutions</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    output_key_correct_solution_example</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">pseudo_correct_solution_example</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">print</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Generated columns:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> result_keys</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-reasoningquestiongeneratorâœ¨ğŸš€" tabindex="-1"><a class="header-anchor" href="#_3-reasoningquestiongeneratorâœ¨ğŸš€"><span>3. ReasoningQuestionGeneratorâœ¨ğŸš€</span></a></h3><p><strong>åŠŸèƒ½æè¿°ï¼š</strong> è¯¥ç®—å­èƒ½å¤ŸåŸºäºç°æœ‰é—®é¢˜ç”Ÿæˆæ–°çš„ç›¸å…³é—®é¢˜ï¼Œæ”¯æŒå¤šç§ç”Ÿæˆç­–ç•¥å’Œéš¾åº¦æ§åˆ¶ã€‚</p><p><strong>è¾“å…¥å‚æ•°ï¼š</strong></p><ul><li><code>__init__()</code><ul><li><code>llm_serving</code>ï¼šä½¿ç”¨çš„å¤§è¯­è¨€æ¨¡å‹æ¥å£å¯¹è±¡ï¼ˆé»˜è®¤ï¼šå‰æ–‡é¢„è®¾å€¼ï¼‰</li><li><code>num_prompts</code>ï¼šæ¯ä¸ªé—®é¢˜ç”Ÿæˆæ–°é—®é¢˜æ•°é‡ï¼ˆé»˜è®¤ï¼š3ï¼‰</li><li><code>prompt_template</code>ï¼šç”Ÿæˆé—®é¢˜çš„æç¤ºæ¨¡æ¿å¯¹è±¡ï¼ˆä¾‹å¦‚<code>GeneralQuestionSynthesisPrompt()</code>ï¼‰</li></ul></li><li><code>run()</code><ul><li><code>storage</code>ï¼šå­˜å‚¨æ¥å£å¯¹è±¡ï¼ˆé»˜è®¤ï¼šå‰æ–‡é¢„è®¾å€¼ï¼‰</li><li><code>input_key</code>ï¼šè¾“å…¥åŸå§‹é—®é¢˜å­—æ®µåï¼ˆé»˜è®¤ï¼š&quot;source_question&quot;ï¼‰</li><li><code>output_key</code>ï¼šè¾“å‡ºæ–°é—®é¢˜å­—æ®µåï¼ˆé»˜è®¤ï¼š&quot;generated_question&quot;ï¼‰</li></ul></li></ul><p><strong>ä¸»è¦ç‰¹æ€§ï¼š</strong></p><ul><li>å¤šæ ·åŒ–é—®é¢˜ç”Ÿæˆç­–ç•¥</li><li>éš¾åº¦çº§åˆ«è‡ªåŠ¨è°ƒèŠ‚</li><li>çŸ¥è¯†ç‚¹è¦†ç›–ä¼˜åŒ–</li><li>è¯­è¨€è¡¨è¾¾å¤šæ ·æ€§</li></ul><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong></p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> dataflow</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">prompts</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">reasoning</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">general </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> GeneralQuestionSynthesisPrompt</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">question_gen </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ReasoningQuestionGenerator</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">                num_prompts</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">3</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # from 1 to k</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">                llm_serving</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">api_llm_serving</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">                prompt_template</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">GeneralQuestionSynthesisPrompt</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">                )</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">result </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> question_gen</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">run</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">          storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">step</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(),</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">          input_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">source_question</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">          output_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">generated_question</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">          )</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-reasoningpretrainformatconvertgeneratorâœ¨" tabindex="-1"><a class="header-anchor" href="#_4-reasoningpretrainformatconvertgeneratorâœ¨"><span>4. ReasoningPretrainFormatConvertGeneratorâœ¨</span></a></h3><p><strong>åŠŸèƒ½æè¿°ï¼š</strong> è¯¥ç®—å­ç”¨äºå°†SFTï¼ˆç›‘ç£å¾®è°ƒï¼‰æ ¼å¼æ•°æ®è½¬æ¢ä¸ºé¢„è®­ç»ƒæ ¼å¼ï¼Œæ”¯æŒè‡ªå®šä¹‰è¾“å…¥è¾“å‡ºé”®é…ç½®ï¼Œé€‚ç”¨äºå„ç±»ç”Ÿæˆå¼æ¨¡å‹çš„é¢„è®­ç»ƒæ•°æ®å‡†å¤‡ã€‚</p><p><strong>è¾“å…¥å‚æ•°ï¼š</strong></p><ul><li><code>__init__()</code><ul><li><code>read_key_question</code>ï¼šé—®é¢˜å­—æ®µåï¼ˆé»˜è®¤ï¼š&quot;question&quot;ï¼‰</li><li><code>read_key_answer</code>ï¼šç­”æ¡ˆå­—æ®µåï¼ˆé»˜è®¤ï¼š&quot;answer&quot;ï¼‰</li><li><code>output_key</code>ï¼šè¾“å‡ºå­—æ®µåï¼ˆé»˜è®¤ï¼š&quot;text&quot;ï¼‰</li></ul></li><li><code>run()</code><ul><li><code>storage</code>ï¼šå­˜å‚¨æ¥å£å¯¹è±¡ï¼ˆé»˜è®¤ï¼šå‰æ–‡é¢„è®¾å€¼ï¼‰</li></ul></li></ul><p><strong>ä¸»è¦ç‰¹æ€§ï¼š</strong></p><ul><li>æ”¯æŒå¤šç§æ ¼å¼è½¬æ¢è§„åˆ™</li><li>è‡ªå®šä¹‰è¾“å…¥è¾“å‡ºé”®æ˜ å°„</li><li>æ‰¹é‡å¤„ç†ä¼˜åŒ–</li><li>å…¼å®¹ä¸»æµé¢„è®­ç»ƒæ•°æ®æ ¼å¼</li></ul><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong></p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">format_converter </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ReasoningPretrainFormatConvertGenerator</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    read_key_question</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">question</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    read_key_answer</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">answer</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    output_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">text</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">result </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> format_converter</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">run</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">step</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">())</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-reasoningquestioncategorysampleevaluatorâœ¨ğŸš€" tabindex="-1"><a class="header-anchor" href="#_5-reasoningquestioncategorysampleevaluatorâœ¨ğŸš€"><span>5. ReasoningQuestionCategorySampleEvaluatorâœ¨ğŸš€</span></a></h3><p><strong>åŠŸèƒ½æè¿°ï¼š</strong><br> è¯¥ç®—å­ç”¨äºå¯¹ç”¨æˆ·é—®é¢˜è¿›è¡Œå¤šçº§åˆ†ç±»ï¼ˆä¸»åˆ†ç±»å’Œå­åˆ†ç±»ï¼‰ã€‚é€šè¿‡å¤§è¯­è¨€æ¨¡å‹å¯¹è¾“å…¥é—®é¢˜è¿›è¡Œè¯­ä¹‰åˆ†æï¼Œè¾“å‡ºæ ‡å‡†åŒ–åçš„åˆ†ç±»ç¼–ç ï¼Œä¾¿äºä¸‹æ¸¸ä»»åŠ¡ä½¿ç”¨ã€‚</p><p><strong>è¾“å…¥å‚æ•°ï¼š</strong></p><ul><li><code>__init__()</code><ul><li><code>llm_serving</code>ï¼šä½¿ç”¨çš„å¤§è¯­è¨€æ¨¡å‹æ¥å£å¯¹è±¡ï¼ˆé»˜è®¤ï¼šå‰æ–‡é¢„è®¾å€¼ï¼‰</li></ul></li><li><code>run()</code><ul><li><code>storage</code>ï¼šæ•°æ®å­˜å‚¨æ¥å£å¯¹è±¡ï¼ˆé»˜è®¤ï¼šå‰æ–‡é¢„è®¾å€¼ï¼‰</li><li><code>input_key</code>ï¼šè¾“å…¥é—®é¢˜å­—æ®µåï¼ˆé»˜è®¤ï¼š&quot;instruction&quot;ï¼‰</li><li><code>output_key</code>ï¼šè¾“å‡ºåˆ†ç±»ç»“æœå­—æ®µåï¼ˆé»˜è®¤ï¼š&quot;question_category&quot;ï¼‰</li></ul></li></ul><p><strong>ä¸»è¦ç‰¹æ€§ï¼š</strong></p><ul><li>ä¸»åˆ†ç±»ä¸å­åˆ†ç±»è‡ªåŠ¨æå–ä¸æ ‡å‡†åŒ–</li><li>è‡ªåŠ¨æ¸…ç†å¼‚å¸¸ JSON ä¸é ASCII å­—ç¬¦</li><li>å¤šæ ·åŒ– Prompt é‡ç»„ä»¥å¢å¼ºåˆ†ç±»ç¨³å¥æ€§</li><li>æ—¥å¿—è¯¦ç»†è¿½è¸ªå¼‚å¸¸æ•°æ®</li></ul><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong></p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">classifier </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ReasoningQuestionCategorySampleEvaluator</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">llm_serving</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">api_llm_serving</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">result_cols </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> classifier</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">run</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">step</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(),</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    input_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">instruction</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    output_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">question_category</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-reasoningquestiondifficultysampleevaluatorâœ¨" tabindex="-1"><a class="header-anchor" href="#_6-reasoningquestiondifficultysampleevaluatorâœ¨"><span>6. ReasoningQuestionDifficultySampleEvaluatorâœ¨</span></a></h3><p><strong>åŠŸèƒ½æè¿°ï¼š</strong><br> è¯¥ç®—å­ç”¨äºè¯„ä¼°é—®é¢˜çš„éš¾åº¦ç­‰çº§ï¼Œé€šè¿‡å¤§è¯­è¨€æ¨¡å‹å¯¹é—®é¢˜è¿›è¡Œå¤æ‚åº¦åˆ†æï¼Œè¾“å‡º 1-10 çº§çš„æ•°å€¼å‹éš¾åº¦è¯„åˆ†ã€‚</p><p><strong>è¾“å…¥å‚æ•°ï¼š</strong></p><ul><li><code>__init__()</code><ul><li><code>llm_serving</code>ï¼šä½¿ç”¨çš„å¤§è¯­è¨€æ¨¡å‹æ¥å£å¯¹è±¡ï¼ˆé»˜è®¤ï¼šå‰æ–‡é¢„è®¾å€¼ï¼‰</li></ul></li><li><code>run()</code><ul><li><code>storage</code>ï¼šæ•°æ®å­˜å‚¨æ¥å£å¯¹è±¡ï¼ˆé»˜è®¤ï¼šå‰æ–‡é¢„è®¾å€¼ï¼‰</li><li><code>input_key</code>ï¼šè¾“å…¥é—®é¢˜å­—æ®µåï¼ˆé»˜è®¤ï¼š&quot;instruction&quot;ï¼‰</li><li><code>output_key</code>ï¼šè¾“å‡ºéš¾åº¦è¯„åˆ†å­—æ®µåï¼ˆé»˜è®¤ï¼š&quot;difficulty_score&quot;ï¼‰</li></ul></li></ul><p><strong>ä¸»è¦ç‰¹æ€§ï¼š</strong></p><ul><li>è‡ªåŠ¨ç”Ÿæˆè¯„ä¼° Prompt</li><li>ä» LLM è¾“å‡ºä¸­è§£æ <code>Rating: x</code> çš„è¯„åˆ†å€¼</li><li>æ—¥å¿—è®°å½•è§£æå¼‚å¸¸ä¸åŸå§‹å­—ç¬¦ä¸²</li><li>é€‚é…æ ‡å‡†æ•°æ®å­˜å‚¨ä¸æ‰¹é‡å†™å‡º</li></ul><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong></p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">difficulty </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ReasoningQuestionDifficultySampleEvaluator</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">llm_serving</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">api_llm_serving</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">result_cols </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> difficulty</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">run</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">step</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(),</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    input_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">instruction</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    output_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">difficulty_score</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-reasoninganswerformatterfilter" tabindex="-1"><a class="header-anchor" href="#_7-reasoninganswerformatterfilter"><span>7. ReasoningAnswerFormatterFilter</span></a></h3><p><strong>åŠŸèƒ½æè¿°ï¼š</strong> è¯¥ç®—å­ä¸“é—¨ç”¨äºæ£€æŸ¥æ•°å­¦ç­”æ¡ˆçš„æ ¼å¼è§„èŒƒæ€§ï¼Œç¡®ä¿ç­”æ¡ˆç¬¦åˆæ ‡å‡†çš„æ•°å­¦è¡¨ç¤ºæ ¼å¼ã€‚</p><p><strong>è¾“å…¥å‚æ•°ï¼š</strong></p><ul><li><code>run()</code><ul><li><code>storage</code>ï¼šå­˜å‚¨æ¥å£å¯¹è±¡ï¼ˆé»˜è®¤ï¼šå‰æ–‡é¢„è®¾å€¼ï¼‰</li><li><code>input_key</code>ï¼šè¾“å…¥ç­”æ¡ˆå­—æ®µåï¼ˆé»˜è®¤ï¼š&quot;generated_cot&quot;ï¼‰</li></ul></li></ul><p><strong>ä¸»è¦ç‰¹æ€§ï¼š</strong></p><ul><li>æ£€æŸ¥\\boxed{}æ ‡è®°æ ¼å¼</li><li>éªŒè¯æ•°å­¦ç¬¦å·æ­£ç¡®æ€§</li><li>æ”¯æŒå¤šç§æ•°å­¦è¡¨ç¤ºæ ¼å¼</li><li>è‡ªåŠ¨æ ¼å¼ä¿®æ­£å»ºè®®</li></ul><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong></p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">filter_op </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ReasoningAnswerFormatterFilter</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">result </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> filter_op</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">run</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">          storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">step</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(),</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">          input_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">generated_cot</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">          )</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-reasoninganswergroundtruthfilterâœ¨" tabindex="-1"><a class="header-anchor" href="#_8-reasoninganswergroundtruthfilterâœ¨"><span>8. ReasoningAnswerGroundTruthFilterâœ¨</span></a></h3><p><strong>åŠŸèƒ½æè¿°ï¼š</strong> è¯¥ç®—å­ç”¨äºå¯¹æ¯”é¢„æµ‹ç­”æ¡ˆä¸æ ‡å‡†ç­”æ¡ˆçš„åŒ¹é…åº¦ï¼Œæ”¯æŒå¤šç§æ¯”è¾ƒç­–ç•¥ã€‚</p><p><strong>è¾“å…¥å‚æ•°ï¼š</strong></p><ul><li><code>__init__()</code><ul><li><code>compare_method</code>ï¼šæ¯”è¾ƒæ–¹æ³•ï¼ˆ&quot;exact&quot; or &quot;math_verify&quot;ï¼‰</li></ul></li><li><code>run()</code><ul><li><code>storage</code>ï¼šå­˜å‚¨æ¥å£å¯¹è±¡ï¼ˆé»˜è®¤ï¼šå‰æ–‡é¢„è®¾å€¼ï¼‰</li><li><code>test_answer_key</code>ï¼šé¢„æµ‹ç­”æ¡ˆå­—æ®µåï¼ˆé»˜è®¤ï¼š&quot;generated_cot&quot;ï¼‰</li><li><code>gt_answer_key</code>ï¼šæ ‡å‡†ç­”æ¡ˆå­—æ®µåï¼ˆé»˜è®¤ï¼š&quot;golden_answer&quot;ï¼‰</li></ul></li></ul><p><strong>ä¸»è¦ç‰¹æ€§ï¼š</strong></p><ul><li>ç²¾ç¡®å­—ç¬¦ä¸²åŒ¹é…</li><li>æ•°å­¦ç­‰ä»·æ€§éªŒè¯</li><li>æ•°å€¼å®¹å·®å¤„ç†</li><li>ç¬¦å·åŒ–æ¯”è¾ƒ</li></ul><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong></p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">filter_op </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ReasoningAnswerGroundTruthFilter</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">compare_method</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">math_verify</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">result </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> filter_op</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">run</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">          storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">step</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(),</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> </span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">          test_answer_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">generated_cot</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">          gt_answer_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">golden_answer</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">          )</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-reasoninganswerjudgemathverifyfilterâœ¨" tabindex="-1"><a class="header-anchor" href="#_9-reasoninganswerjudgemathverifyfilterâœ¨"><span>9. ReasoningAnswerJudgeMathVerifyFilterâœ¨</span></a></h3><p><strong>åŠŸèƒ½æè¿°ï¼š</strong> è¯¥ç®—å­é€šè¿‡é«˜çº§ç¬¦å·è®¡ç®—éªŒè¯æ•°å­¦ç­”æ¡ˆçš„æ­£ç¡®æ€§ï¼Œæ”¯æŒå¤æ‚æ•°å­¦è¡¨è¾¾å¼çš„ç­‰ä»·æ€§åˆ¤æ–­ã€‚</p><p><strong>è¾“å…¥å‚æ•°ï¼š</strong></p><ul><li><code>run()</code><ul><li><code>storage</code>ï¼šå­˜å‚¨æ¥å£å¯¹è±¡ï¼ˆé»˜è®¤ï¼šå‰æ–‡é¢„è®¾å€¼ï¼‰</li><li><code>answer_key</code>ï¼šå¾…éªŒè¯ç­”æ¡ˆå­—æ®µåï¼ˆé»˜è®¤ï¼š&quot;student_answer&quot;ï¼‰</li><li><code>gt_key</code>ï¼šæ ‡å‡†ç­”æ¡ˆå­—æ®µåï¼ˆé»˜è®¤ï¼š&quot;correct_answer&quot;ï¼‰</li></ul></li></ul><p><strong>ä¸»è¦ç‰¹æ€§ï¼š</strong></p><ul><li>ç¬¦å·è¡¨è¾¾å¼è§£æ</li><li>ç­‰ä»·æ€§æ•°å­¦éªŒè¯</li><li>æ•°å€¼ç²¾åº¦æ§åˆ¶</li><li>å¤šç§æ•°å­¦å‡½æ•°æ”¯æŒ</li></ul><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong></p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">judger_op </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ReasoningAnswerJudgeMathVerifyFilter</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">result </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> judger_op</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">run</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">          storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">step</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(),</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">          answer_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">student_answer</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">          gt_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">correct_answer</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">          )</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10-reasoninganswerngramfilterâœ¨" tabindex="-1"><a class="header-anchor" href="#_10-reasoninganswerngramfilterâœ¨"><span>10. ReasoningAnswerNgramFilterâœ¨</span></a></h3><p><strong>åŠŸèƒ½æè¿°ï¼š</strong> è¯¥ç®—å­åŸºäºn-gramç»Ÿè®¡åˆ†ææ£€æµ‹ç­”æ¡ˆä¸­çš„é‡å¤æ¨¡å¼ï¼Œè¿‡æ»¤ä½è´¨é‡çš„é‡å¤å†…å®¹ã€‚</p><p><strong>è¾“å…¥å‚æ•°ï¼š</strong></p><ul><li><code>__init__()</code><ul><li><code>min_score</code>ï¼šæœ€å°å¯æ¥å—åˆ†æ•°ï¼ˆé»˜è®¤ï¼š0.1ï¼‰</li><li><code>max_score</code>ï¼šæœ€å¤§å¯æ¥å—åˆ†æ•°ï¼ˆé»˜è®¤ï¼š1.0ï¼‰</li><li><code>ngrams</code>ï¼šn-gramå¤§å°ï¼ˆé»˜è®¤ï¼š5ï¼‰</li></ul></li><li><code>run()</code><ul><li><code>storage</code>ï¼šå­˜å‚¨æ¥å£å¯¹è±¡ï¼ˆé»˜è®¤ï¼šå‰æ–‡é¢„è®¾å€¼ï¼‰</li><li><code>question_key</code>ï¼šé—®é¢˜å­—æ®µåï¼ˆé»˜è®¤ï¼š&quot;instruction&quot;ï¼‰</li><li><code>answer_key</code>ï¼šç­”æ¡ˆå­—æ®µåï¼ˆé»˜è®¤ï¼š&quot;generated_cot&quot;ï¼‰</li></ul></li></ul><p><strong>ä¸»è¦ç‰¹æ€§ï¼š</strong></p><ul><li>N-gramé‡å¤ç‡è®¡ç®—</li><li>å¯é…ç½®çš„é˜ˆå€¼èŒƒå›´</li><li>æ–‡æœ¬é¢„å¤„ç†å’Œæ¸…ç†</li><li>ç»Ÿè®¡åˆ†ææŠ¥å‘Š</li></ul><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong></p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">ngram_filter </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ReasoningAnswerNgramFilter</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">                min_score</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">0.1</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">                max_score</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">1.0</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">                ngrams</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">5</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">                )</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">result </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ngram_filter</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">run</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">          storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">step</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(),</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">          question_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">instruction</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">          answer_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">generated_cot</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">          )</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_11-reasoninganswerpipelinerootfilterâœ¨" tabindex="-1"><a class="header-anchor" href="#_11-reasoninganswerpipelinerootfilterâœ¨"><span>11. ReasoningAnswerPipelineRootFilterâœ¨</span></a></h3><p><strong>åŠŸèƒ½æè¿°ï¼š</strong> ç­”æ¡ˆå¤„ç†æµç¨‹çš„æ ¹èŠ‚ç‚¹ç®—å­ï¼Œè´Ÿè´£æ™ºèƒ½åˆ†å‘æ•°æ®åˆ°ä¸åŒçš„å¤„ç†åˆ†æ”¯ã€‚</p><p><strong>è¾“å…¥å‚æ•°ï¼š</strong></p><ul><li><code>run()</code><ul><li><code>storage</code>ï¼šå­˜å‚¨æ¥å£å¯¹è±¡ï¼ˆé»˜è®¤ï¼šå‰æ–‡é¢„è®¾å€¼ï¼‰</li><li><code>input_answer_key</code>ï¼šè¾“å…¥ç­”æ¡ˆå­—æ®µåï¼ˆé»˜è®¤ï¼š&quot;output&quot;ï¼‰</li><li><code>input_gt_key</code>ï¼šè¾“å…¥æ ‡å‡†ç­”æ¡ˆå­—æ®µåï¼ˆé»˜è®¤ï¼š&quot;golden_answer&quot;ï¼‰</li></ul></li></ul><p><strong>ä¸»è¦ç‰¹æ€§ï¼š</strong></p><ul><li>æ™ºèƒ½æ•°æ®åˆ†å‘</li><li>æœ‰/æ— æ ‡å‡†ç­”æ¡ˆåˆ†æ”¯å¤„ç†</li><li>ç­”æ¡ˆæå–å’Œæ¸…ç†</li><li>æµç¨‹çŠ¶æ€ç®¡ç†</li></ul><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong></p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">root_op </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ReasoningAnswerPipelineRootFilter</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">result </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> root_op</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">run</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">          storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">step</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(),</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">          input_answer_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">output</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">          input_gt_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">golden_answer</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">          )</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_12-reasoninganswertokenlengthfilter" tabindex="-1"><a class="header-anchor" href="#_12-reasoninganswertokenlengthfilter"><span>12. ReasoningAnswerTokenLengthFilter</span></a></h3><p><strong>åŠŸèƒ½æè¿°ï¼š</strong> è¯¥ç®—å­æ ¹æ®tokenæ•°é‡æ§åˆ¶ç­”æ¡ˆé•¿åº¦ï¼Œè¿‡æ»¤è¿‡é•¿æˆ–è¿‡çŸ­çš„ç­”æ¡ˆå†…å®¹ã€‚</p><p><strong>è¾“å…¥å‚æ•°ï¼š</strong></p><ul><li><code>__init__()</code><ul><li><code>max_answer_token_length</code>ï¼šæœ€å¤§tokenæ•°ï¼ˆé»˜è®¤ï¼š8192ï¼‰</li><li><code>tokenizer_dir</code>ï¼šåˆ†è¯å™¨è·¯å¾„ï¼ˆé»˜è®¤ï¼š&quot;Qwen/Qwen2.5-0.5B-Instruct&quot;ï¼‰</li></ul></li><li><code>run()</code><ul><li><code>storage</code>ï¼šå­˜å‚¨æ¥å£å¯¹è±¡ï¼ˆé»˜è®¤ï¼šå‰æ–‡é¢„è®¾å€¼ï¼‰</li><li><code>input_key</code>ï¼šè¾“å…¥å­—æ®µåï¼ˆé»˜è®¤ï¼š&quot;generated_cot&quot;ï¼‰</li></ul></li></ul><p><strong>ä¸»è¦ç‰¹æ€§ï¼š</strong></p><ul><li>ç²¾ç¡®tokenè®¡æ•°</li><li>å¯é…ç½®åˆ†è¯å™¨</li><li>æ‰¹é‡å¤„ç†ä¼˜åŒ–</li><li>é•¿åº¦ç»Ÿè®¡æŠ¥å‘Š</li></ul><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong></p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">length_filter </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ReasoningAnswerTokenLengthFilter</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">                  max_answer_token_length</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">8192</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">                  tokenizer_dir</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">Qwen/Qwen2.5-0.5B-Instruct</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">                  )</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">result </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> length_filter</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">run</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">          storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">step</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(),</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">          input_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">generated_cot</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">          )</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_13-reasoningquestionfilterâœ¨ğŸš€" tabindex="-1"><a class="header-anchor" href="#_13-reasoningquestionfilterâœ¨ğŸš€"><span>13. ReasoningQuestionFilterâœ¨ğŸš€</span></a></h3><p><strong>åŠŸèƒ½æè¿°ï¼š</strong> è¯¥ç®—å­å¯¹æ•°å­¦é—®é¢˜è¿›è¡Œå…¨é¢çš„è´¨é‡æ£€æŸ¥ï¼Œç¡®ä¿é—®é¢˜çš„æ­£ç¡®æ€§å’Œå¯è§£æ€§ã€‚</p><p><strong>è¾“å…¥å‚æ•°ï¼š</strong></p><ul><li><code>__init__()</code><ul><li><code>llm_serving</code>ï¼šä½¿ç”¨çš„å¤§è¯­è¨€æ¨¡å‹æ¥å£å¯¹è±¡ï¼ˆé»˜è®¤ï¼šå‰æ–‡é¢„è®¾å€¼ï¼‰</li><li><code>system_prompt</code>ï¼šç³»ç»Ÿæç¤ºè¯</li><li><code>prompt_template</code>ï¼šç”Ÿæˆé—®é¢˜çš„æç¤ºæ¨¡æ¿å¯¹è±¡ï¼ˆä¾‹å¦‚<code>GeneralQuestionFilterPrompt()</code>ï¼‰</li></ul></li><li><code>run()</code><ul><li><code>storage</code>ï¼šå­˜å‚¨æ¥å£å¯¹è±¡ï¼ˆé»˜è®¤ï¼šå‰æ–‡é¢„è®¾å€¼ï¼‰</li><li><code>input_key</code>ï¼šè¾“å…¥é—®é¢˜å­—æ®µåï¼ˆé»˜è®¤ï¼š&quot;math_problem&quot;ï¼‰</li></ul></li></ul><p><strong>ä¸»è¦ç‰¹æ€§ï¼š</strong></p><ul><li>å››é˜¶æ®µè´¨é‡æ£€æŸ¥</li><li>æ ¼å¼è§„èŒƒéªŒè¯</li><li>è¯­ä¹‰åˆç†æ€§åˆ†æ</li><li>é€»è¾‘ä¸€è‡´æ€§æ£€æŸ¥</li><li>å¯è§£æ€§è¯„ä¼°</li></ul><p><strong>æ£€æŸ¥ç»´åº¦ï¼š</strong></p><ol><li><strong>æ ¼å¼æ£€æŸ¥</strong>ï¼šéªŒè¯é—®é¢˜è¡¨è¿°æ˜¯å¦è§„èŒƒ</li><li><strong>è¯­ä¹‰æ£€æŸ¥</strong>ï¼šåˆ†æé—®é¢˜æ˜¯å¦æœ‰æ˜ç¡®å«ä¹‰</li><li><strong>é€»è¾‘æ£€æŸ¥</strong>ï¼šæ£€æŸ¥æ¡ä»¶æ˜¯å¦çŸ›ç›¾</li><li><strong>å¯è§£æ€§æ£€æŸ¥</strong>ï¼šè¯„ä¼°æ˜¯å¦å…·å¤‡å……åˆ†ä¿¡æ¯</li></ol><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong></p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> dataflow</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">prompts</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">reasoning</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">general </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> GeneralQuestionFilterPrompt</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">question_filter </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> ReasoningQuestionFilter</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    llm_serving</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">api_llm_serving</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    system_prompt</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">You are a math problem validator.</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    prompt_template</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">GeneralQuestionFilterPrompt</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    )</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">result </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> question_filter</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">run</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">          storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">step</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(),</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">          input_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">math_problem</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">          )</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,124)]))}const p=i(t,[["render",e]]),r=JSON.parse('{"path":"/zh/guide/Reasoning_operators/","title":"å¼ºæ¨ç†ç®—å­","lang":"zh-CN","frontmatter":{"title":"å¼ºæ¨ç†ç®—å­","createTime":"2025/06/24 11:43:42","permalink":"/zh/guide/Reasoning_operators/"},"readingTime":{"minutes":12.73,"words":3819},"git":{"createdTime":1750777722000,"updatedTime":1757862943000,"contributors":[{"name":"Hao Liang","username":"","email":"hao.liang@stu.pku.edu.cn","commits":1,"avatar":"https://gravatar.com/avatar/105bae3e8661728b9f2f5440992b04f5f28459b66a049d09b52213ce1438f6bc?d=retro"},{"name":"scuuy","username":"scuuy","email":"912074188@qq.com","commits":12,"avatar":"https://avatars.githubusercontent.com/scuuy?v=4","url":"https://github.com/scuuy"},{"name":"Sunnyhaze","username":"Sunnyhaze","email":"mxch1122@126.com","commits":2,"avatar":"https://avatars.githubusercontent.com/Sunnyhaze?v=4","url":"https://github.com/Sunnyhaze"},{"name":"HeRunming","username":"HeRunming","email":"2100010636@stu.pku.edu.cn","commits":2,"avatar":"https://avatars.githubusercontent.com/HeRunming?v=4","url":"https://github.com/HeRunming"}]},"filePathRelative":"zh/notes/guide/domain_specific_operators/reasoning_operators.md","headers":[]}');export{p as comp,r as data};
