import{_ as i,c as a,b as n,o as l}from"./app-GpZKBnvo.js";const t={};function h(e,s){return l(),a("div",null,s[0]||(s[0]=[n(`<h2 id="æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#æ¦‚è¿°"><span>æ¦‚è¿°</span></a></h2><p>Text-to-SQLç®—å­æ˜¯ä¸“é—¨ç”¨äºText-to-SQLé—®é¢˜æ•°æ®å¤„ç†å’Œè´¨é‡æå‡çš„ç®—å­é›†åˆï¼Œæ—¨åœ¨ï¼š</p><ul><li>æ¸…æ´—å¹¶æ‰©å……ç°æœ‰çš„Text-to-SQLæ•°æ®é›†</li><li>ä¸ºæ¯ä¸ªæ ·æœ¬ç”ŸæˆåŒ…å«è®­ç»ƒæç¤ºè¯ï¼ˆpromptï¼‰å’Œé•¿é“¾æ¨ç†è¿‡ç¨‹ï¼ˆchain-of-thoughtï¼‰çš„é«˜è´¨é‡é—®ç­”å¯¹</li><li>æä¾›å¤šç»´åº¦çš„æ•°æ®è´¨é‡è¯„ä¼°å’Œéš¾åº¦åˆ†çº§</li></ul><p>å¼€æºçš„ç®—å­ç§ç±»æ˜¯ååˆ†å—é™çš„ï¼Œä¸ºäº†è·å¾—æ›´å¥½çš„æ•°æ®å¤„ç†è´¨é‡ï¼Œå¡«è¡¥å¼€æºç¼ºå¤±çš„æ•°æ®åˆæˆä¸å¤„ç†æ–¹æ³•ï¼Œæˆ‘ä»¬ç²¾å¿ƒè®¾è®¡å¹¶<strong>è‡ªç ”</strong>äº†æ–°çš„ç®—å­é›†ï¼Œå…¶æ ‡è®°å«ä¹‰å¦‚ä¸‹ï¼š</p><ul><li>ğŸš€ <strong>è‡ªä¸»åˆ›æ–°</strong>ï¼šæ ¸å¿ƒç®—æ³•åŸåˆ›ç ”å‘ï¼Œå¡«è¡¥ç°æœ‰ç®—æ³•ç©ºç™½æˆ–æ˜¯è¿›ä¸€æ­¥æå‡æ€§èƒ½ï¼Œçªç ´å½“ä¸‹æ€§èƒ½ç“¶é¢ˆã€‚</li><li>âœ¨ <strong>å¼€æºé¦–å‘</strong>ï¼šé¦–æ¬¡å°†è¯¥ç®—å­é›†æˆåˆ°ç¤¾åŒºä¸»æµæ¡†æ¶ä¸­ï¼Œæ–¹ä¾¿æ›´å¤šå¼€å‘è€…ä½¿ç”¨ï¼Œå®ç°å¼€æºå…±äº«ã€‚</li></ul><h2 id="æ•°æ®ç”Ÿæˆç®—å­" tabindex="-1"><a class="header-anchor" href="#æ•°æ®ç”Ÿæˆç®—å­"><span>æ•°æ®ç”Ÿæˆç®—å­</span></a></h2><table class="tg"><thead><tr><th class="tg-0pky">åç§°</th><th class="tg-0pky">é€‚ç”¨ç±»å‹</th><th class="tg-0pky">ç®€ä»‹</th><th class="tg-0pky">å®˜æ–¹ä»“åº“æˆ–è®ºæ–‡</th></tr></thead><tbody><tr><td class="tg-0pky">SQLGenerator</td><td class="tg-0pky">æ•°æ®ç”Ÿæˆ</td><td class="tg-0pky">åŸºäºæ•°æ®åº“Schemaç”Ÿæˆå¤šæ ·åŒ–SQLè¯­å¥</td><td class="tg-0pky"><a href="https://arxiv.org/abs/2503.02240">OmniSQL</a></td></tr><tr><td class="tg-0pky">SQLVariationGeneratorğŸš€</td><td class="tg-0pky">æ•°æ®å¢å¼º</td><td class="tg-0pky">åŸºäºSQLè¯­å¥å’Œæ•°æ®åº“Schemaç”ŸæˆSQLå˜ä½“</td><td class="tg-0pky">-</td></tr><tr><td class="tg-0pky">Text2SQLQuestionGenerator</td><td class="tg-0pky">é—®é¢˜ç”Ÿæˆ</td><td class="tg-0pky">åŸºäºSQLè¯­å¥ç”Ÿæˆå¯¹åº”çš„è‡ªç„¶è¯­è¨€é—®é¢˜</td><td class="tg-0pky"><a href="https://arxiv.org/abs/2503.02240">OmniSQL</a></td></tr><tr><td class="tg-0pky">Text2SQLPromptGeneratorâœ¨</td><td class="tg-0pky">æç¤ºè¯ç”Ÿæˆ</td><td class="tg-0pky">æ„å»ºåŒ…å«Schemaå’Œé—®é¢˜çš„è®­ç»ƒæç¤ºè¯</td><td class="tg-0pky">-</td></tr><tr><td class="tg-0pky">Text2SQLCoTGenerator</td><td class="tg-0pky">æ¨ç†é“¾ç”Ÿæˆ</td><td class="tg-0pky">ç”ŸæˆSQLæ¨ç†çš„é€æ­¥æ€ç»´é“¾è¿‡ç¨‹</td><td class="tg-0pky"><a href="https://arxiv.org/abs/2503.02240">OmniSQL</a></td></tr></tbody></table><h2 id="æ•°æ®è¯„ä¼°ç®—å­" tabindex="-1"><a class="header-anchor" href="#æ•°æ®è¯„ä¼°ç®—å­"><span>æ•°æ®è¯„ä¼°ç®—å­</span></a></h2><table class="tg"><thead><tr><th class="tg-0pky">åç§°</th><th class="tg-0pky">é€‚ç”¨ç±»å‹</th><th class="tg-0pky">ç®€ä»‹</th><th class="tg-0pky">å®˜æ–¹ä»“åº“æˆ–è®ºæ–‡</th></tr></thead><tbody><tr><td class="tg-0pky">SQLComponentClassifier</td><td class="tg-0pky">éš¾åº¦è¯„ä¼°</td><td class="tg-0pky">åŸºäºSQLè¯­æ³•å¤æ‚åº¦è¿›è¡Œéš¾åº¦åˆ†çº§</td><td class="tg-0pky"><a href="https://arxiv.org/abs/1809.08887">Spider</a></td></tr><tr><td class="tg-0pky">SQLExecutionClassifierğŸš€</td><td class="tg-0pky">æ‰§è¡Œéš¾åº¦è¯„ä¼°</td><td class="tg-0pky">åŸºäºæ¨¡å‹æ‰§è¡ŒæˆåŠŸç‡è¿›è¡Œéš¾åº¦åˆ†çº§</td><td class="tg-0pky">-</td></tr></tbody></table><h2 id="æ•°æ®è¿‡æ»¤ç®—å­" tabindex="-1"><a class="header-anchor" href="#æ•°æ®è¿‡æ»¤ç®—å­"><span>æ•°æ®è¿‡æ»¤ç®—å­</span></a></h2><table class="tg"><thead><tr><th class="tg-0pky">åç§°</th><th class="tg-0pky">é€‚ç”¨ç±»å‹</th><th class="tg-0pky">ç®€ä»‹</th><th class="tg-0pky">å®˜æ–¹ä»“åº“æˆ–è®ºæ–‡</th></tr></thead><tbody><tr><td class="tg-0pky">SQLExecutionFilterâœ¨</td><td class="tg-0pky">æ•°æ®æ¸…æ´—</td><td class="tg-0pky">è¿‡æ»¤æ— æ³•æ­£å¸¸æ‰§è¡Œçš„SQLè¯­å¥</td><td class="tg-0pky">-</td></tr><tr><td class="tg-0pky">SQLConsistencyFilterâœ¨</td><td class="tg-0pky">æ•°æ®æ¸…æ´—</td><td class="tg-0pky">éªŒè¯SQLä¸é—®é¢˜æè¿°çš„è¯­ä¹‰ä¸€è‡´æ€§</td><td class="tg-0pky">-</td></tr></tbody></table><h2 id="ç®—å­æ¥å£è°ƒç”¨è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#ç®—å­æ¥å£è°ƒç”¨è¯´æ˜"><span>ç®—å­æ¥å£è°ƒç”¨è¯´æ˜</span></a></h2><p>ç‰¹åˆ«åœ°ï¼Œå¯¹äºæŒ‡å®šå­˜å‚¨è·¯å¾„ç­‰æˆ–æ˜¯è°ƒç”¨æ¨¡å‹çš„ç®—å­ï¼Œæˆ‘ä»¬æä¾›äº†å°è£…åçš„<strong>æ¨¡å‹æ¥å£</strong>ã€<strong>å­˜å‚¨å¯¹è±¡æ¥å£</strong>å’Œ<strong>æ•°æ®åº“ç®¡ç†æ¥å£</strong>ï¼Œå¯ä»¥é€šè¿‡è¿™äº›æ¥å£ï¼Œå¯¹æ‰€éœ€è¦ä½¿ç”¨çš„é…ç½®è¿›è¡Œé¢„å®šä¹‰ã€‚</p><h3 id="æ¨¡å‹æ¥å£é…ç½®" tabindex="-1"><a class="header-anchor" href="#æ¨¡å‹æ¥å£é…ç½®"><span>æ¨¡å‹æ¥å£é…ç½®</span></a></h3><p>å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¸ºç®—å­è¿›è¡Œæ¨¡å‹APIå‚æ•°é¢„å®šä¹‰ï¼ŒåŒ…æ‹¬ç”Ÿæˆå¼æ¨¡å‹å’ŒåµŒå…¥æ¨¡å‹ï¼š</p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> dataflow</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">serving </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> APILLMServing_request</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">api_llm_serving </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> APILLMServing_request</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    api_url</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">your_api_url</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">        # APIæœåŠ¡åœ°å€</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    model_name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">model_name</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">       # æ¨¡å‹åç§°</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    max_workers</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">5</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">                  # æœ€å¤§å¹¶å‘æ•°</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">embedding_serving </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> APILLMServing_request</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    api_url</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">http://api.openai.com/v1/embeddings</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    model_name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">text-embedding-ada-002</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    max_workers</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">100</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å­˜å‚¨æ¥å£é…ç½®" tabindex="-1"><a class="header-anchor" href="#å­˜å‚¨æ¥å£é…ç½®"><span>å­˜å‚¨æ¥å£é…ç½®</span></a></h3><p>å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¸ºç®—å­è¿›è¡Œå­˜å‚¨å‚æ•°é¢„å®šä¹‰ï¼š</p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> dataflow</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">utils</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> FileStorage</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> FileStorage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    first_entry_file_name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">your_file_path</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">           # åˆå§‹æ–‡ä»¶è·¯å¾„</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    cache_path</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">./cache</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">                             # ç¼“å­˜ç›®å½•</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    file_name_prefix</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">dataflow_cache_step</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">           # æ–‡ä»¶åå‰ç¼€</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    cache_type</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">jsonl</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">                               # ç¼“å­˜æ–‡ä»¶ç±»å‹</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ•°æ®åº“ç®¡ç†æ¥å£é…ç½®" tabindex="-1"><a class="header-anchor" href="#æ•°æ®åº“ç®¡ç†æ¥å£é…ç½®"><span>æ•°æ®åº“ç®¡ç†æ¥å£é…ç½®</span></a></h3><p>ç”±äºéœ€è¦ä½¿ç”¨æ•°æ®åº“Schemaä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹çš„æ–¹å¼å¯¹æ•°æ®åº“ç®¡ç†è¿›è¡Œé¢„å®šä¹‰ï¼Œåœ¨ç®—å­ä¸­ï¼Œé€šè¿‡ä¸æ•°æ®åº“ç®¡ç†å™¨è¿›è¡Œäº¤äº’ï¼Œå®ç°å¯¹æ•°æ®åº“ä¿¡æ¯çš„è¯»å–å’Œç®¡ç†ï¼š</p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> dataflow</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">utils</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">text2sql</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">database_manager </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> DatabaseManager</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">database_manager </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> DatabaseManager</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    db_type</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">your_db_type</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # ç›®å‰æ”¯æŒ SQLite å’Œ MySQL</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    config</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">={</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">        &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">your_db_config_key</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">your_db_config_value</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    }</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    </span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äº SQLite å’Œ MySQL æ•°æ®åº“ï¼Œåˆ†åˆ«éœ€è¦æŒ‰ç…§ä¸‹é¢çš„æ–¹å¼æ¥è¿›è¡Œé…ç½®ï¼š</p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># SQLite å®Œæ•´ç¤ºä¾‹</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">database_manager </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> DatabaseManager</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    db_type</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">sqlite</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    config</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">={</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">        &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">root_path</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">/path/to/your/database/folder</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # åŒ…å«SQLiteæ–‡ä»¶çš„ç›®å½•è·¯å¾„</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    }</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># MySQL å®Œæ•´ç¤ºä¾‹</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">database_manager </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> DatabaseManager</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    db_type</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">mysql</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    config</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">={</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">        &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">host</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">localhost</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">           # æ•°æ®åº“ä¸»æœºåœ°å€</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">        &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">user</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">root</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">               # ç”¨æˆ·å</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">        &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">password</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">your_password</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">   # å¯†ç </span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">        &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">database</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">your_database_name</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # æ•°æ®åº“å</span></span>
<span class="line"><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">        &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">port</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">:</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 3306</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">                  # ç«¯å£å·ï¼ˆå¯é€‰ï¼Œé»˜è®¤3306ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    }</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æç¤ºè¯æ¨¡æ¿é…ç½®" tabindex="-1"><a class="header-anchor" href="#æç¤ºè¯æ¨¡æ¿é…ç½®"><span>æç¤ºè¯æ¨¡æ¿é…ç½®</span></a></h3><p>ç®—å­æ”¯æŒä½¿ç”¨é¢„å®šä¹‰çš„æç¤ºè¯æ¨¡æ¿ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å¯¼å…¥å’Œä½¿ç”¨ï¼š</p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> dataflow</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">prompts</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">text2sql </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> (</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    Text2SQLCotGeneratorPrompt</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    SelectSQLGeneratorPrompt</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    Text2SQLQuestionGeneratorPrompt</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    Text2SQLPromptGeneratorPrompt</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    SQLConsistencyFilterPrompt</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">    SQLVariationGeneratorPrompt</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åæ–‡ä½¿ç”¨çš„<code>llm_serving</code>ã€<code>storage</code>ã€<code>database_manager</code>å’Œæç¤ºè¯æ¨¡æ¿å³ä¸ºæ­¤å¤„å·²å®šä¹‰çš„æ¥å£å¯¹è±¡ï¼Œå®Œæ•´è°ƒç”¨ç¤ºä¾‹å¯å‚è€ƒå®é™…çš„pipelineä»£ç ã€‚</p><p>å¯¹äºä¼ å‚ï¼Œç®—å­å¯¹è±¡çš„æ„é€ å‡½æ•°ä¸»è¦ä¼ é€’ä¸ç®—å­é…ç½®ç›¸å…³çš„ä¿¡æ¯ï¼Œé…ç½®åå¯ä»¥ä¸€é…ç½®å¤šè°ƒç”¨ï¼›è€Œ<code>X.run()</code>å‡½æ•°ä¼ é€’ä¸IOç›¸å…³çš„<code>key</code>ä¿¡æ¯ï¼Œè¯¦ç»†å¯è§åæ–‡ç®—å­è¯´æ˜ç¤ºä¾‹ã€‚</p><h2 id="è¯¦ç»†ç®—å­è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#è¯¦ç»†ç®—å­è¯´æ˜"><span>è¯¦ç»†ç®—å­è¯´æ˜</span></a></h2><h3 id="æ•°æ®ç”Ÿæˆç®—å­-1" tabindex="-1"><a class="header-anchor" href="#æ•°æ®ç”Ÿæˆç®—å­-1"><span>æ•°æ®ç”Ÿæˆç®—å­</span></a></h3><h4 id="_1-sqlgenerator" tabindex="-1"><a class="header-anchor" href="#_1-sqlgenerator"><span>1. SQLGenerator</span></a></h4><p><strong>åŠŸèƒ½æè¿°ï¼š</strong> åŸºäºæ•°æ®åº“Schemaç”Ÿæˆå¤šæ ·åŒ–çš„SQLè¯­å¥</p><ul><li>ç”Ÿæˆè¦†ç›–å„ç§SQLè¯­æ³•ã€éš¾åº¦çš„æŸ¥è¯¢è¯­å¥</li><li>æ”¯æŒå¤æ‚æŸ¥è¯¢å¦‚JOINã€å­æŸ¥è¯¢ã€èšåˆå‡½æ•°ç­‰</li></ul><p><strong>è¾“å…¥å‚æ•°ï¼š</strong></p><ul><li><p><code>__init__()</code></p><ul><li><code>llm_serving</code>: LLMæœåŠ¡æ¥å£ï¼Œç”¨äºSQLç”Ÿæˆ</li><li><code>database_manager</code>: æ•°æ®åº“ç®¡ç†å™¨ï¼Œç”¨äºè®¿é—®æ•°æ®åº“Schema</li><li><code>generate_num</code>: æ¯ä¸ªæ•°æ®åº“ç”ŸæˆSQLè¯­å¥çš„æ•°é‡</li><li><code>prompt_template</code>: SQLç”Ÿæˆçš„æç¤ºè¯æ¨¡æ¿</li></ul></li><li><p><code>run()</code></p><ul><li><code>output_sql_key</code>: è¾“å‡ºSQLè¯­å¥å­—æ®µåï¼Œé»˜è®¤&quot;SQL&quot;</li><li><code>output_db_id_key</code>: è¾“å‡ºæ•°æ®åº“IDå­—æ®µåï¼Œé»˜è®¤&quot;db_id&quot;</li></ul></li></ul><p><strong>ä¸»è¦ç‰¹æ€§ï¼š</strong></p><ul><li>æ™ºèƒ½Schemaåˆ†æå’ŒSQLæ¨¡æ¿ç”Ÿæˆ</li><li>æ”¯æŒå¤šç§æ•°æ®åº“ç±»å‹ï¼ˆSQLiteã€MySQLï¼‰</li><li>è‡ªåŠ¨å¤„ç†è¡¨å…³ç³»å’Œå¤–é”®çº¦æŸ</li><li>ç”Ÿæˆè¦†ç›–ä¸åŒéš¾åº¦ç­‰çº§çš„SQL</li></ul><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong></p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> dataflow</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">prompts</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">text2sql </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> SelectSQLGeneratorPrompt</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">sql_generator </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> SQLGenerator</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    llm_serving</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">llm_serving</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    database_manager</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">database_manager</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    generate_num</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">50</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    prompt_template</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">SelectSQLGeneratorPrompt</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">sql_generator</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">run</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">step</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(),</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    output_sql_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">SQL</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    output_db_id_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">db_id</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-sqlvariationgeneratorğŸš€" tabindex="-1"><a class="header-anchor" href="#_2-sqlvariationgeneratorğŸš€"><span>2. SQLVariationGeneratorğŸš€</span></a></h4><p><strong>åŠŸèƒ½æè¿°ï¼š</strong> åŸºäºSQLè¯­å¥å’Œæ•°æ®åº“Schemaç”ŸæˆSQLè¯­å¥å˜ä½“</p><ul><li>å¢åŠ è¯­æ³•å¤šæ ·æ€§</li><li>æ”¯æŒåˆ«åæ›¿æ¢ã€å­æŸ¥è¯¢è½¬æ¢ã€JOINé‡å†™ç­‰</li><li>æœ‰æ•ˆæ‰©å……è®­ç»ƒæ•°æ®çš„å¤šæ ·æ€§</li></ul><p><strong>è¾“å…¥å‚æ•°ï¼š</strong></p><ul><li><p><code>__init__()</code></p><ul><li><code>llm_serving</code>: LLMæœåŠ¡æ¥å£ï¼Œç”¨äºSQLå˜ä½“ç”Ÿæˆ</li><li><code>database_manager</code>: æ•°æ®åº“ç®¡ç†å™¨ï¼Œç”¨äºéªŒè¯å˜ä½“æ­£ç¡®æ€§</li><li><code>num_variations</code>: æ¯ä¸ªSQLç”Ÿæˆçš„å˜ä½“æ•°é‡ï¼Œé»˜è®¤5</li><li><code>prompt_template</code>: SQLå˜ä½“ç”Ÿæˆçš„æç¤ºè¯æ¨¡æ¿</li></ul></li><li><p><code>run()</code></p><ul><li><code>input_sql_key</code>: SQLè¯­å¥å­—æ®µåï¼Œé»˜è®¤&quot;SQL&quot;</li><li><code>input_db_id_key</code>: æ•°æ®åº“IDå­—æ®µåï¼Œé»˜è®¤&quot;db_id&quot;</li></ul></li></ul><p><strong>ä¸»è¦ç‰¹æ€§ï¼š</strong></p><ul><li>æ™ºèƒ½SQLå˜ä½“ç”Ÿæˆ</li><li>è¦†ç›–å¤šç§ä¸åŒå˜ä½“æ–¹å‘ï¼Œç¡®ä¿SQLè¯­å¥çš„å¤šæ ·æ€§</li><li>æ”¯æŒå¤æ‚æŸ¥è¯¢çš„å¤šç§è¡¨è¾¾æ–¹å¼</li></ul><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong></p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> dataflow</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">prompts</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">text2sql </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> SQLVariationGeneratorPrompt</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">sql_variation_generator </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> SQLVariationGenerator</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    llm_serving</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">llm_serving</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    database_manager</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">database_manager</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    num_variations</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">5</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    prompt_template</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">SQLVariationGeneratorPrompt</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">sql_variation_generator</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">run</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">step</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(),</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    input_sql_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">SQL</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    input_db_id_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">db_id</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-text2sqlquestiongenerator" tabindex="-1"><a class="header-anchor" href="#_3-text2sqlquestiongenerator"><span>3. Text2SQLQuestionGenerator</span></a></h4><p><strong>åŠŸèƒ½æè¿°ï¼š</strong> åŸºäºSQLè¯­å¥ç”Ÿæˆå¯¹åº”çš„è‡ªç„¶è¯­è¨€é—®é¢˜</p><ul><li>åˆ†æSQLè¯­ä¹‰ç”Ÿæˆåˆç†çš„è‡ªç„¶è¯­è¨€é—®é¢˜</li><li>ä½¿ç”¨embeddingæŠ€æœ¯é€‰æ‹©æœ€ä¼˜é—®é¢˜å€™é€‰</li><li>ç¡®ä¿é—®é¢˜ä¸SQLæŸ¥è¯¢æ„å›¾çš„ä¸€è‡´æ€§</li><li>æ”¯æŒå¤šç§é—®é¢˜è¡¨è¾¾é£æ ¼</li></ul><p><strong>è¾“å…¥å‚æ•°ï¼š</strong></p><ul><li><p><code>__init__()</code></p><ul><li><code>llm_serving</code>: LLMæœåŠ¡æ¥å£ï¼Œç”¨äºé—®é¢˜ç”Ÿæˆ</li><li><code>embedding_serving</code>: åµŒå…¥æ¨¡å‹æ¥å£ï¼Œç”¨äºé—®é¢˜é€‰æ‹©</li><li><code>database_manager</code>: æ•°æ®åº“ç®¡ç†å™¨ï¼Œç”¨äºSchemaä¿¡æ¯è·å–</li><li><code>question_candidates_num</code>: é—®é¢˜å€™é€‰æ•°é‡ï¼Œé»˜è®¤5</li><li><code>prompt_template</code>: é—®é¢˜ç”Ÿæˆçš„æç¤ºè¯æ¨¡æ¿</li></ul></li><li><p><code>run()</code></p><ul><li><code>input_sql_key</code>: SQLè¯­å¥å­—æ®µåï¼Œé»˜è®¤&quot;SQL&quot;</li><li><code>input_db_id_key</code>: æ•°æ®åº“IDå­—æ®µåï¼Œé»˜è®¤&quot;db_id&quot;</li><li><code>output_question_key</code>: è¾“å‡ºé—®é¢˜å­—æ®µåï¼Œé»˜è®¤&quot;question&quot;</li></ul></li></ul><p><strong>ä¸»è¦ç‰¹æ€§ï¼š</strong></p><ul><li>åŸºäºSQLè¯­ä¹‰çš„æ™ºèƒ½é—®é¢˜ç”Ÿæˆ</li><li>å¤šå€™é€‰é—®é¢˜ç”Ÿæˆå’Œæœ€ä¼˜é€‰æ‹©</li><li>ç»“åˆæ•°æ®åº“Schemaçš„ä¸Šä¸‹æ–‡ç†è§£</li><li>ç¡®ä¿é—®é¢˜çš„è‡ªç„¶æ€§å’Œå‡†ç¡®æ€§</li></ul><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong></p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> dataflow</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">prompts</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">text2sql </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Text2SQLQuestionGeneratorPrompt</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">text2sql_question_generator </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Text2SQLQuestionGenerator</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    llm_serving</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">llm_serving</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    embedding_serving</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">embedding_serving</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    database_manager</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">database_manager</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    question_candidates_num</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">5</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    prompt_template</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">Text2SQLQuestionGeneratorPrompt</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">text2sql_question_generator</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">run</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">step</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(),</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    input_sql_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">SQL</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    input_db_id_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">db_id</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    output_question_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">question</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-text2sqlpromptgeneratorâœ¨" tabindex="-1"><a class="header-anchor" href="#_4-text2sqlpromptgeneratorâœ¨"><span>4. Text2SQLPromptGeneratorâœ¨</span></a></h4><p><strong>åŠŸèƒ½æè¿°ï¼š</strong> æ„å»ºåŒ…å«Schemaå’Œé—®é¢˜çš„è®­ç»ƒæç¤ºè¯</p><ul><li>æ ¼å¼åŒ–æ•°æ®åº“Schemaä¿¡æ¯</li><li>ç»“åˆé—®é¢˜ç”Ÿæˆæ ‡å‡†åŒ–çš„è®­ç»ƒæç¤ºè¯</li><li>æ”¯æŒå¤šç§Schemaæ ¼å¼ï¼ˆDDLã€æ ¼å¼åŒ–Schemaç­‰ï¼‰</li><li>å¯é…ç½®æ˜¯å¦åŒ…å«ç¤ºä¾‹æ•°æ®</li></ul><p><strong>è¾“å…¥å‚æ•°ï¼š</strong></p><ul><li><p><code>__init__()</code></p><ul><li><code>database_manager</code>: æ•°æ®åº“ç®¡ç†å™¨ï¼Œç”¨äºSchemaä¿¡æ¯è·å–</li><li><code>prompt_template</code>: æç¤ºè¯æ¨¡æ¿ï¼Œå¿…é¡»åŒ…å«{schema}å’Œ{question}å ä½ç¬¦</li></ul></li><li><p><code>run()</code></p><ul><li><code>input_question_key</code>: é—®é¢˜å­—æ®µåï¼Œé»˜è®¤&quot;question&quot;</li><li><code>input_db_id_key</code>: æ•°æ®åº“IDå­—æ®µåï¼Œé»˜è®¤&quot;db_id&quot;</li><li><code>output_prompt_key</code>: è¾“å‡ºæç¤ºè¯å­—æ®µåï¼Œé»˜è®¤&quot;prompt&quot;</li></ul></li></ul><p><strong>ä¸»è¦ç‰¹æ€§ï¼š</strong></p><ul><li>çµæ´»çš„æç¤ºè¯æ¨¡æ¿ç³»ç»Ÿ</li><li>å¤šç§Schemaæ ¼å¼æ”¯æŒ</li><li>è‡ªåŠ¨Schemaæ ¼å¼åŒ–å’Œä¼˜åŒ–</li><li>æ”¯æŒåŒ…å«ç¤ºä¾‹æ•°æ®çš„Schema</li></ul><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong></p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> dataflow</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">prompts</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">text2sql </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Text2SQLPromptGeneratorPrompt</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">text2sql_prompt_generator </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Text2SQLPromptGenerator</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    database_manager</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">database_manager</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    prompt_template</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">Text2SQLPromptGeneratorPrompt</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">text2sql_prompt_generator</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">run</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">step</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(),</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    input_question_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">question</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    input_db_id_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">db_id</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    output_prompt_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">prompt</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-text2sqlcotgenerator" tabindex="-1"><a class="header-anchor" href="#_5-text2sqlcotgenerator"><span>5. Text2SQLCoTGenerator</span></a></h4><p><strong>åŠŸèƒ½æè¿°ï¼š</strong> ç”ŸæˆSQLæ¨ç†çš„é€æ­¥æ€ç»´é“¾è¿‡ç¨‹</p><ul><li>åŸºäºé—®é¢˜å’ŒSQLç”Ÿæˆè¯¦ç»†çš„æ¨ç†æ­¥éª¤</li><li>è§£é‡ŠSQLæ„å»ºçš„é€»è¾‘è¿‡ç¨‹</li><li>æ”¯æŒé”™è¯¯é‡è¯•å’Œè´¨é‡ä¿è¯</li><li>æå‡æ¨¡å‹çš„æ¨ç†èƒ½åŠ›å’Œå¯è§£é‡Šæ€§</li></ul><p><strong>è¾“å…¥å‚æ•°ï¼š</strong></p><ul><li><p><code>__init__()</code></p><ul><li><code>llm_serving</code>: LLMæœåŠ¡æ¥å£ï¼Œç”¨äºCoTç”Ÿæˆ</li><li><code>database_manager</code>: æ•°æ®åº“ç®¡ç†å™¨ï¼Œç”¨äºSchemaä¿¡æ¯è·å–</li><li><code>max_retries</code>: æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤3</li><li><code>enable_retry</code>: æ˜¯å¦å¯ç”¨é‡è¯•æœºåˆ¶ï¼Œé»˜è®¤True</li><li><code>prompt_template</code>: CoTç”Ÿæˆçš„æç¤ºè¯æ¨¡æ¿</li></ul></li><li><p><code>run()</code></p><ul><li><code>input_sql_key</code>: SQLè¯­å¥å­—æ®µåï¼Œé»˜è®¤&quot;SQL&quot;</li><li><code>input_question_key</code>: é—®é¢˜å­—æ®µåï¼Œé»˜è®¤&quot;question&quot;</li><li><code>input_db_id_key</code>: æ•°æ®åº“IDå­—æ®µåï¼Œé»˜è®¤&quot;db_id&quot;</li><li><code>output_cot_key</code>: è¾“å‡ºCoTæ¨ç†å­—æ®µåï¼Œé»˜è®¤&quot;cot_reasoning&quot;</li></ul></li></ul><p><strong>ä¸»è¦ç‰¹æ€§ï¼š</strong></p><ul><li>é«˜è´¨é‡çš„æ¨ç†é“¾ç”Ÿæˆ</li><li>è‡ªåŠ¨é”™è¯¯æ£€æµ‹å’Œé‡è¯•æœºåˆ¶</li><li>ç»“åˆSchemaçš„ä¸Šä¸‹æ–‡æ¨ç†</li><li>æ”¯æŒå¤æ‚æŸ¥è¯¢çš„é€æ­¥åˆ†è§£</li></ul><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong></p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> dataflow</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">prompts</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">text2sql </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Text2SQLCotGeneratorPrompt</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">text2sql_cot_generator </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Text2SQLCoTGenerator</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    llm_serving</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">cot_generation_llm_serving</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    database_manager</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">database_manager</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    max_retries</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">3</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    enable_retry</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">True</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    prompt_template</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">Text2SQLCotGeneratorPrompt</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">text2sql_cot_generator</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">run</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">step</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(),</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    input_sql_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">SQL</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    input_question_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">question</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    input_db_id_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">db_id</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    output_cot_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">cot_reasoning</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ•°æ®è¯„ä¼°ç®—å­-1" tabindex="-1"><a class="header-anchor" href="#æ•°æ®è¯„ä¼°ç®—å­-1"><span>æ•°æ®è¯„ä¼°ç®—å­</span></a></h3><h4 id="_1-sqlcomponentclassifier" tabindex="-1"><a class="header-anchor" href="#_1-sqlcomponentclassifier"><span>1. SQLComponentClassifier</span></a></h4><p><strong>åŠŸèƒ½æè¿°ï¼š</strong> åŸºäºSQLè¯­æ³•å¤æ‚åº¦è¿›è¡Œéš¾åº¦åˆ†çº§</p><ul><li>åˆ†æSQLè¯­å¥çš„è¯­æ³•ç»„ä»¶å¤æ‚åº¦</li><li>æ ¹æ®JOINæ•°é‡ã€å­æŸ¥è¯¢æ·±åº¦ã€èšåˆå‡½æ•°ç­‰è¿›è¡Œè¯„åˆ†</li><li>æ”¯æŒè‡ªå®šä¹‰éš¾åº¦é˜ˆå€¼å’Œæ ‡ç­¾</li><li>æä¾›æ ‡å‡†åŒ–çš„éš¾åº¦åˆ†ç±»ä½“ç³»</li></ul><p><strong>è¾“å…¥å‚æ•°ï¼š</strong></p><ul><li><p><code>__init__()</code></p><ul><li><code>difficulty_thresholds</code>: éš¾åº¦é˜ˆå€¼åˆ—è¡¨ï¼Œé»˜è®¤[2, 4, 6]</li><li><code>difficulty_labels</code>: éš¾åº¦æ ‡ç­¾åˆ—è¡¨ï¼Œé»˜è®¤[&#39;easy&#39;, &#39;medium&#39;, &#39;hard&#39;, &#39;extra&#39;]</li></ul></li><li><p><code>run()</code></p><ul><li><code>input_sql_key</code>: SQLè¯­å¥å­—æ®µåï¼Œé»˜è®¤&quot;SQL&quot;</li><li><code>output_difficulty_key</code>: è¾“å‡ºéš¾åº¦æ ‡ç­¾å­—æ®µåï¼Œé»˜è®¤&quot;sql_component_difficulty&quot;</li></ul></li></ul><p><strong>ä¸»è¦ç‰¹æ€§ï¼š</strong></p><ul><li>åŸºäºSQLè¯­æ³•ç»“æ„çš„å¤æ‚åº¦åˆ†æ</li><li>å¯é…ç½®çš„éš¾åº¦é˜ˆå€¼å’Œæ ‡ç­¾</li><li>å¿«é€Ÿæ‰¹é‡å¤„ç†èƒ½åŠ›</li><li>æ ‡å‡†åŒ–çš„éš¾åº¦è¯„ä¼°ä½“ç³»</li></ul><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong></p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">sql_component_classifier </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> SQLComponentClassifier</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    difficulty_thresholds</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=[</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">2</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 4</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 6</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">],</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    difficulty_labels</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=[</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">easy</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">medium</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">hard</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">extra</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">sql_component_classifier</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">run</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">step</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(),</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    input_sql_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">SQL</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    output_difficulty_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">sql_component_difficulty</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-sqlexecutionclassifierğŸš€" tabindex="-1"><a class="header-anchor" href="#_2-sqlexecutionclassifierğŸš€"><span>2. SQLExecutionClassifierğŸš€</span></a></h4><p><strong>åŠŸèƒ½æè¿°ï¼š</strong> åŸºäºæ¨¡å‹æ‰§è¡ŒæˆåŠŸç‡è¿›è¡Œéš¾åº¦åˆ†çº§</p><ul><li>ä½¿ç”¨LLMå¤šæ¬¡å°è¯•ç”ŸæˆSQLæ¥è¯„ä¼°éš¾åº¦</li><li>æ ¹æ®æ¨¡å‹æˆåŠŸç‡åŠ¨æ€è°ƒæ•´éš¾åº¦ç­‰çº§</li><li>æä¾›æ›´è´´è¿‘å®é™…åº”ç”¨çš„éš¾åº¦è¯„ä¼°</li><li>æ”¯æŒè‡ªå®šä¹‰éš¾åº¦é…ç½®å’Œç”Ÿæˆæ¬¡æ•°</li></ul><p><strong>è¾“å…¥å‚æ•°ï¼š</strong></p><ul><li><p><code>__init__()</code></p><ul><li><code>llm_serving</code>: LLMæœåŠ¡æ¥å£ï¼Œç”¨äºSQLç”Ÿæˆæµ‹è¯•</li><li><code>database_manager</code>: æ•°æ®åº“ç®¡ç†å™¨ï¼Œç”¨äºSQLæ‰§è¡ŒéªŒè¯</li><li><code>num_generations</code>: æµ‹è¯•ç”Ÿæˆæ¬¡æ•°ï¼Œé»˜è®¤10</li><li><code>difficulty_thresholds</code>: éš¾åº¦é˜ˆå€¼åˆ—è¡¨ï¼Œé»˜è®¤[2, 5, 9]</li><li><code>difficulty_labels</code>: éš¾åº¦æ ‡ç­¾åˆ—è¡¨ï¼Œé»˜è®¤[&#39;extra&#39;, &#39;hard&#39;, &#39;medium&#39;, &#39;easy&#39;]</li></ul></li><li><p><code>run()</code></p><ul><li><code>input_sql_key</code>: SQLè¯­å¥å­—æ®µåï¼Œé»˜è®¤&quot;SQL&quot;</li><li><code>input_db_id_key</code>: æ•°æ®åº“IDå­—æ®µåï¼Œé»˜è®¤&quot;db_id&quot;</li><li><code>input_prompt_key</code>: æç¤ºè¯å­—æ®µåï¼Œé»˜è®¤&quot;prompt&quot;</li><li><code>output_difficulty_key</code>: è¾“å‡ºéš¾åº¦æ ‡ç­¾å­—æ®µåï¼Œé»˜è®¤&quot;sql_execution_difficulty&quot;</li></ul></li></ul><p><strong>ä¸»è¦ç‰¹æ€§ï¼š</strong></p><ul><li>åŸºäºå®é™…æ¨¡å‹æ€§èƒ½çš„éš¾åº¦è¯„ä¼°</li><li>åŠ¨æ€éš¾åº¦è°ƒæ•´æœºåˆ¶</li><li>å¤šæ¬¡ç”Ÿæˆçš„ç»Ÿè®¡åˆ†æ</li><li>æ›´ç¬¦åˆå®é™…åº”ç”¨åœºæ™¯çš„éš¾åº¦åˆ†çº§</li></ul><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong></p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">sql_execution_classifier </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> SQLExecutionClassifier</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    llm_serving</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">llm_serving</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    database_manager</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">database_manager</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    num_generations</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">10</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    difficulty_thresholds</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=[</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">2</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 5</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 9</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">],</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    difficulty_labels</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=[</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">extra</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">hard</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">medium</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &#39;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">easy</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&#39;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">]</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">sql_execution_classifier</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">run</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">step</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(),</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    input_sql_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">SQL</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    input_db_id_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">db_id</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    input_prompt_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">prompt</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    output_difficulty_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">sql_execution_difficulty</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ•°æ®è¿‡æ»¤ç®—å­-1" tabindex="-1"><a class="header-anchor" href="#æ•°æ®è¿‡æ»¤ç®—å­-1"><span>æ•°æ®è¿‡æ»¤ç®—å­</span></a></h3><h4 id="_1-sqlexecutionfilterâœ¨" tabindex="-1"><a class="header-anchor" href="#_1-sqlexecutionfilterâœ¨"><span>1. SQLExecutionFilterâœ¨</span></a></h4><p><strong>åŠŸèƒ½æè¿°ï¼š</strong> éªŒè¯SQLè¯­å¥çš„å¯æ‰§è¡Œæ€§å’Œè¯­æ³•æ­£ç¡®æ€§</p><ul><li>åœ¨çœŸå®æ•°æ®åº“ç¯å¢ƒä¸­æ‰§è¡ŒSQLè¯­å¥</li><li>æ£€æµ‹è¯­æ³•é”™è¯¯ã€è¿è¡Œæ—¶é”™è¯¯å’Œé€»è¾‘é”™è¯¯</li><li>è¿‡æ»¤æ— æ³•æ­£å¸¸æ‰§è¡Œçš„SQLè¯­å¥</li><li>ç¡®ä¿æ•°æ®é›†ä¸­SQLçš„æœ‰æ•ˆæ€§å’Œå¯ç”¨æ€§</li></ul><p><strong>è¾“å…¥å‚æ•°ï¼š</strong></p><ul><li><p><code>__init__()</code></p><ul><li><code>database_manager</code>: æ•°æ®åº“ç®¡ç†å™¨ï¼Œç”¨äºSQLæ‰§è¡Œå’ŒéªŒè¯</li></ul></li><li><p><code>run()</code></p><ul><li><code>input_sql_key</code>: SQLè¯­å¥å­—æ®µåï¼Œé»˜è®¤&quot;SQL&quot;</li><li><code>input_db_id_key</code>: æ•°æ®åº“IDå­—æ®µåï¼Œé»˜è®¤&quot;db_id&quot;</li></ul></li></ul><p><strong>ä¸»è¦ç‰¹æ€§ï¼š</strong></p><ul><li>å®æ—¶SQLæ‰§è¡ŒéªŒè¯</li><li>è‡ªåŠ¨è¿‡æ»¤æ‰§è¡Œå¤±è´¥çš„SQLè¯­å¥</li><li>é«˜æ•ˆçš„æ‰¹é‡å¤„ç†èƒ½åŠ›</li></ul><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong></p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">sql_execution_filter </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> SQLExecutionFilter</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    database_manager</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">database_manager</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">sql_execution_filter</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">run</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">step</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(),</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    input_sql_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">SQL</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    input_db_id_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">db_id</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-sqlconsistencyfilterâœ¨" tabindex="-1"><a class="header-anchor" href="#_2-sqlconsistencyfilterâœ¨"><span>2. SQLConsistencyFilterâœ¨</span></a></h4><p><strong>åŠŸèƒ½æè¿°ï¼š</strong> éªŒè¯SQLä¸é—®é¢˜æè¿°çš„è¯­ä¹‰ä¸€è‡´æ€§</p><ul><li>ä½¿ç”¨LLMåˆ¤æ–­SQLæ‰§è¡Œç»“æœæ˜¯å¦å›ç­”äº†é—®é¢˜</li><li>æ£€æŸ¥é—®é¢˜ä¸SQLé€»è¾‘çš„åŒ¹é…åº¦</li><li>è¿‡æ»¤è¯­ä¹‰ä¸ä¸€è‡´çš„æ•°æ®å¯¹</li><li>æå‡æ•°æ®é›†çš„è´¨é‡å’Œå¯é æ€§</li></ul><p><strong>è¾“å…¥å‚æ•°ï¼š</strong></p><ul><li><p><code>__init__()</code></p><ul><li><code>llm_serving</code>: LLMæœåŠ¡æ¥å£ï¼Œç”¨äºä¸€è‡´æ€§åˆ¤æ–­</li><li><code>database_manager</code>: æ•°æ®åº“ç®¡ç†å™¨ï¼Œç”¨äºSQLæ‰§è¡Œ</li><li><code>prompt_template</code>: ä¸€è‡´æ€§æ£€æŸ¥çš„æç¤ºè¯æ¨¡æ¿</li></ul></li><li><p><code>run()</code></p><ul><li><code>input_sql_key</code>: SQLè¯­å¥å­—æ®µåï¼Œé»˜è®¤&quot;SQL&quot;</li><li><code>input_db_id_key</code>: æ•°æ®åº“IDå­—æ®µåï¼Œé»˜è®¤&quot;db_id&quot;</li><li><code>input_question_key</code>: é—®é¢˜å­—æ®µåï¼Œé»˜è®¤&quot;question&quot;</li></ul></li></ul><p><strong>ä¸»è¦ç‰¹æ€§ï¼š</strong></p><ul><li>æ™ºèƒ½è¯­ä¹‰ä¸€è‡´æ€§æ£€æŸ¥</li><li>ç»“åˆSQLæ‰§è¡Œç»“æœå’Œé—®é¢˜è¯­ä¹‰</li><li>è‡ªåŠ¨è¿‡æ»¤ä¸åŒ¹é…çš„æ•°æ®å¯¹</li><li>æ”¯æŒå¤æ‚æŸ¥è¯¢çš„ä¸€è‡´æ€§éªŒè¯</li></ul><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong></p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> dataflow</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">prompts</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">text2sql </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> SQLConsistencyFilterPrompt</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">sql_consistency_filter </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> SQLConsistencyFilter</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    llm_serving</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">llm_serving</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    database_manager</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">database_manager</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    prompt_template</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">SQLConsistencyFilterPrompt</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">sql_consistency_filter</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">run</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">step</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(),</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    input_sql_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">SQL</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    input_db_id_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">db_id</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    input_question_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">question</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,114)]))}const p=i(t,[["render",h]]),d=JSON.parse('{"path":"/zh/guide/Text2SQL_operators/","title":"Text2SQLç®—å­","lang":"zh-CN","frontmatter":{"title":"Text2SQLç®—å­","createTime":"2025/06/24 11:43:42","permalink":"/zh/guide/Text2SQL_operators/"},"readingTime":{"minutes":11.2,"words":3359},"git":{"createdTime":1750777722000,"updatedTime":1757913775000,"contributors":[{"name":"Hao Liang","username":"","email":"hao.liang@stu.pku.edu.cn","commits":1,"avatar":"https://gravatar.com/avatar/105bae3e8661728b9f2f5440992b04f5f28459b66a049d09b52213ce1438f6bc?d=retro"},{"name":"TechNomad-ds","username":"TechNomad-ds","email":"18136835112@163.com","commits":8,"avatar":"https://avatars.githubusercontent.com/TechNomad-ds?v=4","url":"https://github.com/TechNomad-ds"}]},"filePathRelative":"zh/notes/guide/domain_specific_operators/text2sql_operators.md","headers":[]}');export{p as comp,d as data};
