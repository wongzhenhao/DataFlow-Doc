import{_ as s,c as a,b as n,o as e}from"./app-GpZKBnvo.js";const l={};function t(h,i){return e(),a("div",null,i[0]||(i[0]=[n(`<p>This pipeline is designed to help beginners quickly get started with fine-tuning models using PDF documents.</p><h2 id="_1-overview" tabindex="-1"><a class="header-anchor" href="#_1-overview"><span>1.Overview</span></a></h2><p>The <strong>Pdf-to-Model Fine-tuning Pipeline</strong> is an end-to-end large language model training solution designed to provide fully automated services from raw documents to deployable domain-specific models. The pipeline transforms heterogeneous-format, high-noise PDF documents into high-quality Multi-Hop QA training data and performs parameter-efficient fine-tuning of large models based on this data, enabling models to achieve precise question-answering capabilities in specific domain knowledge.</p><p>The pipeline integrates advanced document processing technologies (MinerU, trafilatura), intelligent knowledge cleaning methods, and efficient fine-tuning strategies. It significantly enhances model performance in vertical domains while maintaining the general capabilities of base models. According to MIRIAD experimental validation, models trained with Multi-Hop QA format demonstrate excellent performance in complex question-answering scenarios requiring multi-step reasoning.</p><p><strong>Document Parsing Engine</strong>: MinerU1 (recommended to use vlm-backend: pipeline for optimal stability) and partial functionality of MinerU 2.5 (transformers backend)</p><p><strong>Supported Input Formats</strong>: PDF, Markdown, HTML, URL webpages</p><p><strong>Output Model</strong>: Adapter (compatible with any Qwen/Llama series base model)</p><p><strong>Note</strong>: Currently does not support MinerU 2.5 vlm-vllm-engine, as it requires a higher version of vLLM that is incompatible with the current latest version of LLaMA-Factory (primary conflict lies in transformers library version).</p><h2 id="_2-quick-start" tabindex="-1"><a class="header-anchor" href="#_2-quick-start"><span>2.Quick Start</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">conda</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> create</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -n</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> dataflow</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> python=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">3.10</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">conda</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> activate</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> dataflow</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">git</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> clone</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://github.com/OpenDCAI/DataFlow.git</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">cd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> DataFlow</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#prepare environment</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">pip</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -e</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> .[llamafactory]</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># Supports mineru2.5. If you only want to run the pipeline backend, you can skip downloading the whl file and proceed directly to model preparation.</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">wget</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://github.com/Dao-AILab/flash-attention/releases/download/v2.8.3/flash_attn-2.8.3+cu121torch2.4cxx11abiTRUE-cp310-cp310-linux_x86_64.whl</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">pip</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> flash_attn-2.8.3+cu121torch2.4cxx11abiTRUE-cp310-cp310-linux_x86_64.whl</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">#prepare models</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">mineru-models-download</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">cd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ..</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">mkdir</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run_dataflow</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">cd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run_dataflow</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># Initialize</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">dataflow</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> pdf2model</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> init</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># Train</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">dataflow</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> pdf2model</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> train</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># Chat with the trained model, or chat with locally trained models in workspace directory</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">dataflow</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> chat</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-pipeline-design" tabindex="-1"><a class="header-anchor" href="#_3-pipeline-design"><span>3. Pipeline Design</span></a></h2><h3 id="main-pipeline-workflow" tabindex="-1"><a class="header-anchor" href="#main-pipeline-workflow"><span>Main Pipeline Workflow</span></a></h3><p>The Pdf-to-Model pipeline consists of two phases: initialization and execution, with the execution phase comprising 5 core steps:</p><h4 id="initialization-phase-dataflow-pdf2model-init" tabindex="-1"><a class="header-anchor" href="#initialization-phase-dataflow-pdf2model-init"><span>Initialization Phase (dataflow pdf2model init)</span></a></h4><p>Automatically generates training configuration file (train_config.yaml) and customizable data processing scripts, configuring default LoRA fine-tuning parameters, dataset paths, and model output directories.</p><h4 id="execution-phase-dataflow-pdf2model-train" tabindex="-1"><a class="header-anchor" href="#execution-phase-dataflow-pdf2model-train"><span>Execution Phase (dataflow pdf2model train)</span></a></h4><ol><li><strong>Document Discovery</strong>: Automatically scans specified directories to identify all PDF files and generate an index list.</li><li><strong>Knowledge Extraction and Cleaning</strong>: Extracts textual information from PDF/Markdown/HTML/URL using tools like MinerU and trafilatura, performs intelligent segmentation via chonkie, and cleans and normalizes raw text by addressing redundant tags, format errors, and privacy information. <em>(This step reuses the complete workflow of the knowledge base cleaning pipeline)</em></li><li><strong>QA Data Generation</strong>: Utilizes a sliding window of three sentences to transform the cleaned knowledge base into a series of Multi-Hop QA pairs requiring multi-step reasoning, and converts them into LlamaFactory standard training format.</li><li><strong>Fine-tuning</strong>: Based on the generated QA data, uses LoRA (Low-Rank Adaptation) method to perform parameter-efficient fine-tuning of the base model, training model parameters and outputting a domain-specific model adapter ready for deployment.</li></ol><h4 id="testing-phase-dataflow-chat" tabindex="-1"><a class="header-anchor" href="#testing-phase-dataflow-chat"><span>Testing Phase (dataflow chat)</span></a></h4><p><strong>Model Dialogue Testing</strong>: Automatically loads the latest trained adapter and corresponding base model, launches an interactive dialogue interface, and supports real-time testing of model performance on domain-specific knowledge Q&amp;A. Users can also specify a particular model path for testing using the <code>--model</code> parameter.</p><h3 id="step-1-install-dataflow-environment" tabindex="-1"><a class="header-anchor" href="#step-1-install-dataflow-environment"><span>Step 1: Install DataFlow Environment</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">conda</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> create</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -n</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> dataflow</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> python=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">3.10</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">conda</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> activate</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> dataflow</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">cd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> DataFlow</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">pip</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -e</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> .[llamafactory]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># Supports mineru2.5. If you only want to run the pipeline backend, you can skip downloading the whl file and proceed directly to model preparation</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># Download flash-attn whl file. You need to download the corresponding whl based on your environment</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># For example, if your environment is python3.10 torch2.4 cuda12.1 https://github.com/Dao-AILab/flash-attention/releases/download/v2.8.3/flash_attn-2.8.3+cu121torch2.4cxx11abiTRUE-cp310-cp310-linux_x86_64.whl</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># Version selection URL: https://github.com/Dao-AILab/flash-attention/releases</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">wget</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> https://github.com/Dao-AILab/flash-attention/releases/download/v2.8.3/flash_attn-2.8.3+cu121torch2.4cxx11abiTRUE-cp310-cp310-linux_x86_64.whl</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">pip</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> flash_attn-2.8.3+cu121torch2.4cxx11abiTRUE-cp310-cp310-linux_x86_64.whl</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="step-2-create-new-dataflow-working-directory" tabindex="-1"><a class="header-anchor" href="#step-2-create-new-dataflow-working-directory"><span>Step 2: Create New DataFlow Working Directory</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># Exit project root directory</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">cd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ..</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">mkdir</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run_dataflow</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">cd</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> run_dataflow</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="step-3-setup-dataset" tabindex="-1"><a class="header-anchor" href="#step-3-setup-dataset"><span>Step 3: Setup Dataset</span></a></h3><p>Place appropriately sized datasets (data files in PDF format) into the working directory.</p><h3 id="step-4-initialize-dataflow-pdf2model" tabindex="-1"><a class="header-anchor" href="#step-4-initialize-dataflow-pdf2model"><span>Step 4: Initialize dataflow-pdf2model</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># Initialize</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># --cache can specify the location of .cache directory (optional)</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># Default value is current folder directory</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">dataflow</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> pdf2model</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> init</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ðŸ’¡After initialization is complete, the project directory becomes:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">Project</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Root/</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">â”œâ”€â”€</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> pdf_to_qa_pipeline.py</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # pipeline execution file</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">â””â”€â”€</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> .cache/</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">            # cache directory</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    â””â”€â”€</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> train_config.yaml</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # default config file for llamafactory training</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="step-5-set-parameters" tabindex="-1"><a class="header-anchor" href="#step-5-set-parameters"><span>Step 5: Set Parameters</span></a></h3><p>ðŸŒŸ <strong>Display common and important parameters:</strong></p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> FileStorage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    first_entry_file_name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">str</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">cache_path </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">/</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">.cache</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> /</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">gpu</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> /</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">pdf_list.jsonl</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">),</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    cache_path</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">str</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">cache_path </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">/</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">.cache</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> /</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">gpu</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">),</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    file_name_prefix</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">batch_cleaning_step</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # Prefix for created files</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    cache_type</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">jsonl</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # Type of created files</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">knowledge_cleaning_step1 </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> FileOrURLToMarkdownConverterBatch</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    intermediate_dir</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">str</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">cache_path </span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">/</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">.cache</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">),</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    lang</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">en</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    mineru_backend</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">vlm-vllm-engine</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # Options: pipeline, vlm-vllm-engine, vlm-vllm-transformer</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">knowledge_cleaning_step2 </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> KBCChunkGeneratorBatch</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    split_method</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">token</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # Specify the splitting method</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    chunk_size</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">512</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # Specify the chunk size</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    tokenizer_name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">./Qwen2.5-7B-Instruct</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # Path to the tokenizer model</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">extract_format_qa </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> QAExtractor</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    qa_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">qa_pairs</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    output_json_file</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">./.cache/data/qa.json</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="step-6-one-click-fine-tuning" tabindex="-1"><a class="header-anchor" href="#step-6-one-click-fine-tuning"><span>Step 6: One-Click Fine-tuning</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># One-Click Fine-tuning: Directly launch the cleaning + fine-tuning functionality</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">dataflow</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> pdf2model</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> train</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>ðŸ’¡After fine-tuning is complete, the project directory becomes:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">Project</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> Root/</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">â”œâ”€â”€</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> pdf_to_qa_pipeline.py</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # pipeline execution file</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">â””â”€â”€</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> .cache/</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">            # cache directory</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    â”œâ”€â”€</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> train_config.yaml</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # default config file for llamafactory training</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    â”œâ”€â”€</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> data/</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    â”‚</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">   â”œâ”€â”€</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> dataset_info.json</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    â”‚</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">   â””â”€â”€</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> qa.json</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    â”œâ”€â”€</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> gpu/</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    â”‚</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">   â”œâ”€â”€</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> batch_cleaning_step_step1.json</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    â”‚</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">   â”œâ”€â”€</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> batch_cleaning_step_step2.json</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    â”‚</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">   â”œâ”€â”€</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> batch_cleaning_step_step3.json</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    â”‚</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">   â”œâ”€â”€</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> batch_cleaning_step_step4.json</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    â”‚</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">   â””â”€â”€</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> pdf_list.jsonl</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    â”œâ”€â”€</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mineru/</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    â”‚</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">   â””â”€â”€</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> sample/auto/</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    â””â”€â”€</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> saves/</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">        â””â”€â”€</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> pdf2model_cache_{timestamp}/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="step-7-chat-with-fine-tuned-model" tabindex="-1"><a class="header-anchor" href="#step-7-chat-with-fine-tuned-model"><span><strong>Step 7: Chat with Fine-tuned Model</strong></span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># Method 1: Specify model path with --model flag (optional)</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># Default path: .cache/saves/pdf2model_cache_{timestamp}</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">dataflow</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> chat</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --model</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> ./custom_model_path</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># Method 2: Navigate to workspace directory and run dataflow chat</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">dataflow</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> chat</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,38)]))}const d=s(l,[["render",t]]),k=JSON.parse('{"path":"/en/guide/yu798e6s/","title":"PDF-to-Model Model Simulation Pipeline","lang":"en-US","frontmatter":{"title":"PDF-to-Model Model Simulation Pipeline","createTime":"2025/08/30 14:27:01","icon":"solar:cpu-bolt-linear","permalink":"/en/guide/yu798e6s/"},"readingTime":{"minutes":3.27,"words":980},"git":{"createdTime":1756536834000,"updatedTime":1762056197000,"contributors":[{"name":"Yalin-Feng","username":"Yalin-Feng","email":"Feng_Yalin@163.com","commits":2,"avatar":"https://avatars.githubusercontent.com/Yalin-Feng?v=4","url":"https://github.com/Yalin-Feng"},{"name":"Ma, Xiaochen","username":"","email":"mxch1122@126.com","commits":1,"avatar":"https://gravatar.com/avatar/c86bc98abf428aa442dfc12c76e70e324a551ebc637e5ed6634d60fbd3811221?d=retro"},{"name":"YalinFeng01","username":"YalinFeng01","email":"Feng_Yalin@163.com","commits":3,"avatar":"https://avatars.githubusercontent.com/YalinFeng01?v=4","url":"https://github.com/YalinFeng01"}]},"filePathRelative":"en/notes/guide/pipelines/Pdf2ModelPipeline.md","headers":[]}');export{d as comp,k as data};
