import{_ as i,c as a,b as n,o as e}from"./app-GpZKBnvo.js";const t={};function l(h,s){return e(),a("div",null,s[0]||(s[0]=[n(`<h2 id="æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#æ¦‚è¿°"><span>æ¦‚è¿°</span></a></h2><p>RARE (Retrieval-Augmented Reasoning Modeling) æ˜¯ä¸€ç§æ–°é¢–çš„è®­ç»ƒèŒƒå¼ï¼Œå…¶æ ¸å¿ƒæ€æƒ³åœ¨äº<strong>å°†çŸ¥è¯†å­˜å‚¨ä¸æ¨ç†ä¼˜åŒ–ç›¸è§£è€¦</strong>ã€‚RARE å°†é¢†åŸŸçŸ¥è¯†å¤–åŒ–è‡³å¯æ£€ç´¢çš„å¤–éƒ¨æ•°æ®æºï¼Œè®­ç»ƒè¿‡ç¨‹ä¸­ä¸“æ³¨äºå†…åŒ–é¢†åŸŸç‰¹å®šçš„æ¨ç†æ¨¡å¼ã€‚å…·ä½“è€Œè¨€ï¼Œé€šè¿‡å°†æ£€ç´¢åˆ°çš„çŸ¥è¯†æ³¨å…¥è®­ç»ƒæç¤ºä¸­ï¼ŒRARE å°†æ¨¡å‹çš„å­¦ä¹ ç›®æ ‡ä»å¯¹äº‹å®çš„æ­»è®°ç¡¬èƒŒè½¬å˜ä¸ºåŸºäºä¸Šä¸‹æ–‡çš„æ¨ç†ã€‚è¿™ç§æ–¹æ³•ä½¿æ¨¡å‹èƒ½å¤Ÿç»•è¿‡å‚æ•°å¯†é›†çš„çŸ¥è¯†è®°å¿†è¿‡ç¨‹ï¼Œä¼˜å…ˆå‘å±•å’Œä¼˜åŒ–æ›´é«˜é˜¶çš„è®¤çŸ¥ä¸æ¨ç†èƒ½åŠ›ã€‚æˆ‘ä»¬ç²¾å¿ƒè®¾è®¡å¹¶<strong>è‡ªç ”</strong>äº†æ–°çš„ç®—å­é›†ï¼Œå…¶æ ‡è®°å«ä¹‰å¦‚ä¸‹ï¼š</p><ul><li>ğŸš€ <strong>è‡ªä¸»åˆ›æ–°</strong>ï¼šæ ¸å¿ƒç®—æ³•åŸåˆ›ç ”å‘ï¼Œå¡«è¡¥ç°æœ‰ç®—æ³•ç©ºç™½æˆ–æ˜¯è¿›ä¸€æ­¥æå‡æ€§èƒ½ï¼Œçªç ´å½“ä¸‹æ€§èƒ½ç“¶é¢ˆã€‚</li><li>âœ¨ <strong>å¼€æºé¦–å‘</strong>ï¼šé¦–æ¬¡å°†è¯¥ç®—å­é›†æˆåˆ°ç¤¾åŒºä¸»æµæ¡†æ¶ä¸­ï¼Œæ–¹ä¾¿æ›´å¤šå¼€å‘è€…ä½¿ç”¨ï¼Œå®ç°å¼€æºå…±äº«ã€‚</li></ul><h2 id="rare-ç®—å­" tabindex="-1"><a class="header-anchor" href="#rare-ç®—å­"><span>RARE ç®—å­</span></a></h2><p>RARE ç®—å­æµç¨‹é€šè¿‡ä¸‰ä¸ªæ ¸å¿ƒæ­¥éª¤ï¼Œç³»ç»Ÿæ€§åœ°ç”Ÿæˆç”¨äºæ¨ç†èƒ½åŠ›è®­ç»ƒçš„åˆæˆæ•°æ®ã€‚</p><table class="tg"><thead><tr><th class="tg-0pky">åç§°</th><th class="tg-0pky">åº”ç”¨ç±»å‹</th><th class="tg-0pky">æè¿°</th><th class="tg-0pky">å®˜æ–¹ä»“åº“æˆ–è®ºæ–‡</th></tr></thead><tbody><tr><td class="tg-0pky">RAREDoc2QueryGeneratorâœ¨</td><td class="tg-0pky">é—®é¢˜ç”Ÿæˆ</td><td class="tg-0pky">åŸºäºåŸå§‹æ–‡æ¡£ï¼Œç”Ÿæˆéœ€è¦å¤æ‚æ¨ç†æ‰èƒ½è§£ç­”çš„é—®é¢˜å’Œç›¸åº”åœºæ™¯ã€‚</td><td class="tg-0pky">ReasonIR: Training Retrievers for Reasoning Tasks</td></tr><tr><td class="tg-0pky">RAREBM25HardNegGeneratorâœ¨</td><td class="tg-0pky">å›°éš¾è´Ÿä¾‹æŒ–æ˜</td><td class="tg-0pky">ä¸ºç”Ÿæˆçš„é—®é¢˜æŒ–æ˜æ–‡æœ¬ç›¸ä¼¼ä½†è¯­ä¹‰ä¸ç›¸å…³çš„å›°éš¾è´Ÿæ ·æœ¬ï¼Œæ„å»ºå…·æœ‰æŒ‘æˆ˜æ€§çš„æ£€ç´¢ä¸Šä¸‹æ–‡ã€‚</td><td class="tg-0pky">ReasonIR: Training Retrievers for Reasoning Tasks</td></tr><tr><td class="tg-0pky">RAREReasonDistillGeneratorğŸš€</td><td class="tg-0pky">æ¨ç†è¿‡ç¨‹ç”Ÿæˆ</td><td class="tg-0pky">ç»“åˆé—®é¢˜ã€æ­£è´Ÿæ–‡æ¡£ï¼Œæç¤ºå¤§è¯­è¨€æ¨¡å‹ç”Ÿæˆè¯¦å°½çš„æ¨ç†è¿‡ç¨‹ï¼Œä»¥â€œè’¸é¦â€å…¶é¢†åŸŸæ€ç»´æ¨¡å¼ã€‚</td><td class="tg-0pky">RARE: Retrieval-Augmented Reasoning Modeling</td></tr></tbody></table><h2 id="ç®—å­æ¥å£ä½¿ç”¨è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#ç®—å­æ¥å£ä½¿ç”¨è¯´æ˜"><span>ç®—å­æ¥å£ä½¿ç”¨è¯´æ˜</span></a></h2><p>å¯¹äºæŒ‡å®šå­˜å‚¨è·¯å¾„æˆ–è°ƒç”¨æ¨¡å‹çš„ç®—å­ï¼Œæˆ‘ä»¬æä¾›äº†å°è£…å¥½çš„<strong>æ¨¡å‹æ¥å£</strong>å’Œ<strong>å­˜å‚¨å¯¹è±¡æ¥å£</strong>ã€‚ä½ å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼ä¸ºç®—å­é¢„å®šä¹‰æ¨¡å‹ API å‚æ•°ï¼š</p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> dataflow</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">serving</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">api_llm_serving_request </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> APILLMServing_request</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">api_llm_serving </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> APILLMServing_request</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">                api_url</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">your_api_url</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">                key_name_of_api_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">YOUR_API_KEY</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">                model_name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">model_name</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">                max_workers</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;">5</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">        )</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½ å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼ä¸ºç®—å­é¢„å®šä¹‰å­˜å‚¨å‚æ•°ï¼š</p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> dataflow</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">utils</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> FileStorage</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">self</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> FileStorage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">            first_entry_file_name</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">your_file_path</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">            cache_path</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">./cache</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">            file_name_prefix</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">dataflow_cache_step</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">            cache_type</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">json</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"> # jsonl, json, ...</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">        )</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸‹æ–‡ä¸­çš„ <code>api_llm_serving</code> å’Œ <code>self.storage</code> å³ä¸ºæ­¤å¤„å®šä¹‰çš„æ¥å£å¯¹è±¡ã€‚å®Œæ•´çš„ä½¿ç”¨ç¤ºä¾‹å¯è§ <code>test_rare.py</code>ã€‚</p><p>å‚æ•°ä¼ é€’æ–¹é¢ï¼Œç®—å­å¯¹è±¡çš„æ„é€ å‡½æ•°ä¸»è¦ä¼ é€’ä¸ç®—å­é…ç½®ç›¸å…³çš„ä¿¡æ¯ï¼ˆå¦‚ <code>llm_serving</code> å®ä¾‹ï¼‰ï¼Œå¯ä¸€æ¬¡é…ç½®å¤šæ¬¡è°ƒç”¨ï¼›è€Œ <code>X.run()</code> å‡½æ•°åˆ™ä¼ é€’ä¸ IO ç›¸å…³çš„ <code>key</code> ä¿¡æ¯å’Œè¿è¡Œæ—¶å‚æ•°ã€‚å…·ä½“ç»†èŠ‚å¯è§ä¸‹æ–¹ç®—å­æè¿°ç¤ºä¾‹ã€‚</p><h2 id="ç®—å­è¯¦ç»†è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#ç®—å­è¯¦ç»†è¯´æ˜"><span>ç®—å­è¯¦ç»†è¯´æ˜</span></a></h2><h3 id="_1-raredoc2querygenerator" tabindex="-1"><a class="header-anchor" href="#_1-raredoc2querygenerator"><span>1. RAREDoc2QueryGenerator</span></a></h3><p><strong>åŠŸèƒ½æè¿°</strong></p><p>è¯¥ç®—å­æ˜¯ RARE æ•°æ®ç”Ÿæˆæµç¨‹çš„ç¬¬ä¸€æ­¥ã€‚å®ƒåˆ©ç”¨å¤§è¯­è¨€æ¨¡å‹ï¼Œä¸ºç»™å®šçš„æ–‡æ¡£ç‰‡æ®µç”Ÿæˆä¸€ä¸ªç‹¬ç«‹çš„ã€éœ€è¦æ·±å…¥æ¨ç†æ‰èƒ½è§£ç­”çš„é—®é¢˜ï¼Œå¹¶é™„å¸¦ä¸€ä¸ªå®Œæ•´çš„åœºæ™¯æè¿°ã€‚ç”Ÿæˆçš„é—®é¢˜æ—¨åœ¨è„±ç¦»åŸæ–‡ä¹Ÿèƒ½è¢«ç†è§£ï¼Œè€ƒéªŒæ¨¡å‹çš„ç»¼åˆæ¨ç†èƒ½åŠ›è€Œéç®€å•çš„ä¿¡æ¯æŠ½å–ã€‚</p><p><strong>è¾“å…¥å‚æ•°</strong></p><ul><li><code>__init__()</code><ul><li><code>llm_serving</code>: ä½¿ç”¨çš„å¤§è¯­è¨€æ¨¡å‹æ¥å£å¯¹è±¡ï¼ˆ<code>LLMServingABC</code> ç±»å‹ï¼‰ã€‚</li></ul></li><li><code>run()</code><ul><li><code>storage</code>: å­˜å‚¨æ¥å£å¯¹è±¡ã€‚</li><li><code>input_key</code>: è¾“å…¥æ–‡æ¡£å†…å®¹çš„å­—æ®µåï¼ˆé»˜è®¤ï¼š&quot;text&quot;ï¼‰ã€‚</li><li><code>output_question_key</code>: è¾“å‡ºç”Ÿæˆé—®é¢˜çš„å­—æ®µåï¼ˆé»˜è®¤ï¼š&quot;question&quot;ï¼‰ã€‚</li><li><code>output_scenario_key</code>: è¾“å‡ºç”Ÿæˆåœºæ™¯çš„å­—æ®µåï¼ˆé»˜è®¤ï¼š&quot;scenario&quot;ï¼‰ã€‚</li><li><code>max_attempts</code>: è§£æå¤±è´¥æ—¶ï¼Œä¸ºå•ä¸€æ ·æœ¬é‡æ–°è°ƒç”¨å¤§æ¨¡å‹çš„æœ€å¤§å°è¯•æ¬¡æ•°ï¼ˆé»˜è®¤ï¼š3ï¼‰ã€‚</li></ul></li></ul><p><strong>ä½¿ç”¨ç¤ºä¾‹</strong></p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> dataflow</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">operators</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">rare </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> RAREDoc2QueryGenerator</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">doc2query_step </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> RAREDoc2QueryGenerator</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">llm_serving</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">api_llm_serving</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">doc2query_step</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">run</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> self</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">step</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(),</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    input_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">text</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    output_question_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">question</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    output_scenario_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">scenario</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-rarebm25hardneggenerator" tabindex="-1"><a class="header-anchor" href="#_2-rarebm25hardneggenerator"><span>2. RAREBM25HardNegGenerator</span></a></h3><p><strong>åŠŸèƒ½æè¿°</strong></p><p>è¯¥ç®—å­åˆ©ç”¨ç»å…¸çš„ BM25 ç®—æ³•ï¼Œä¸ºæ¯ä¸ªâ€œé—®é¢˜-æ­£é¢æ–‡æ¡£â€å¯¹ï¼Œä»æ•´ä¸ªæ–‡æ¡£åº“ä¸­æ£€ç´¢å¹¶ç­›é€‰å‡ºæœ€ç›¸å…³çš„å›°éš¾è´Ÿæ ·æœ¬ã€‚è¿™äº›è´Ÿæ ·æœ¬åœ¨è¯æ±‡ä¸Šä¸æŸ¥è¯¢é«˜åº¦ç›¸ä¼¼ï¼Œä½†åœ¨è¯­ä¹‰ä¸Šæ˜¯é”™è¯¯çš„æˆ–ä¸ç›¸å…³çš„ç­”æ¡ˆï¼Œæ—¨åœ¨æ„å»ºä¸€ä¸ªå…·æœ‰æŒ‘æˆ˜æ€§çš„æ£€ç´¢ç¯å¢ƒï¼Œè¿«ä½¿æ¨¡å‹åœ¨åç»­æ­¥éª¤ä¸­è¿›è¡Œæ›´ç²¾ç»†çš„æ¨ç†å’Œè¾¨åˆ«ã€‚</p><p><strong>ä¾èµ–å®‰è£…</strong></p><p>RAREBM25HardNegGeneratorç®—å­ä¾èµ–äºpyserini, gensimå’ŒJDKã€‚Linuxé…ç½®æ–¹æ³•å¦‚ä¸‹ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> apt</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> openjdk-21-jdk</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">pip</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> install</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> pyserini</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> gensim</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>è¾“å…¥å‚æ•°</strong></p><ul><li><code>__init__()</code><ul><li>æ— æ„é€ å‚æ•°ã€‚</li></ul></li><li><code>run()</code><ul><li><code>storage</code>: å­˜å‚¨æ¥å£å¯¹è±¡ã€‚</li><li><code>input_question_key</code>: è¾“å…¥é—®é¢˜çš„å­—æ®µåï¼ˆé»˜è®¤ï¼š&quot;question&quot;ï¼‰ã€‚</li><li><code>input_text_key</code>: è¾“å…¥æ­£é¢æ–‡æ¡£å†…å®¹çš„å­—æ®µåï¼ˆé»˜è®¤ï¼š&quot;text&quot;ï¼‰ã€‚</li><li><code>output_negatives_key</code>: è¾“å‡ºå›°éš¾è´Ÿæ ·æœ¬åˆ—è¡¨çš„å­—æ®µåï¼ˆé»˜è®¤ï¼š&quot;hard_negatives&quot;ï¼‰ã€‚</li><li><code>num_neg</code>: ä¸ºæ¯ä¸ªæŸ¥è¯¢æŒ–æ˜çš„å›°éš¾è´Ÿæ ·æœ¬æ•°é‡ï¼ˆé»˜è®¤ï¼š3ï¼‰ã€‚</li></ul></li></ul><p><strong>ä½¿ç”¨ç¤ºä¾‹</strong></p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> dataflow</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">operators</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">rare </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> RAREBM25HardNegGenerator</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">bm25hardneg_step </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> RAREBM25HardNegGenerator</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">()</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">bm25hardneg_step</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">run</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> self</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">step</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(),</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    input_question_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">question</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    input_text_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">text</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    output_negatives_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">hard_negatives</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    num_neg</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 3</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-rarereasondistillgenerator" tabindex="-1"><a class="header-anchor" href="#_3-rarereasondistillgenerator"><span>3. RAREReasonDistillGenerator</span></a></h3><p><strong>åŠŸèƒ½æè¿°</strong></p><p>è¯¥ç®—å­æ˜¯ RARE èŒƒå¼çš„æ ¸å¿ƒå®ç°ã€‚å®ƒå°† <code>RAREDoc2QueryGenerator</code> ç”Ÿæˆçš„é—®é¢˜å’Œåœºæ™¯ã€åŸå§‹çš„æ­£é¢æ–‡æ¡£ä»¥åŠ <code>RAREBM25HardNegGenerator</code> æŒ–æ˜å‡ºçš„å›°éš¾è´Ÿä¾‹æ•´åˆåœ¨ä¸€èµ·ï¼Œæ„å»ºä¸€ä¸ªå¤æ‚çš„ä¸Šä¸‹æ–‡ã€‚ç„¶åï¼Œå®ƒæç¤ºå¤§è¯­è¨€æ¨¡å‹ï¼ˆæ•™å¸ˆæ¨¡å‹ï¼‰åŸºäºæ­¤ä¸Šä¸‹æ–‡ç”Ÿæˆä¸€ä¸ªè¯¦å°½çš„ã€åˆ†æ­¥çš„æ¨ç†è¿‡ç¨‹ã€‚è¿™ä¸ªè¿‡ç¨‹æ—¨åœ¨â€œè’¸é¦â€å‡ºå¤§æ¨¡å‹çš„é¢†åŸŸæ€ç»´æ¨¡å¼ï¼ˆdomain thinkingï¼‰ï¼Œå¹¶ç”Ÿæˆç”¨äºè®­ç»ƒå­¦ç”Ÿæ¨¡å‹çš„æ•°æ®ï¼Œä½¿å…¶å­¦ä¼šå¦‚ä½•è¿›è¡Œä¸Šä¸‹æ–‡æ¨ç†ï¼ˆcontextualized reasoningï¼‰è€Œéä¾èµ–å‚æ•°åŒ–çŸ¥è¯†ã€‚</p><p><strong>è¾“å…¥å‚æ•°</strong></p><ul><li><code>__init__()</code><ul><li><code>llm_serving</code>: ä½¿ç”¨çš„å¤§è¯­è¨€æ¨¡å‹æ¥å£å¯¹è±¡ï¼ˆ<code>LLMServingABC</code> ç±»å‹ï¼‰ã€‚</li></ul></li><li><code>run()</code><ul><li><code>storage</code>: å­˜å‚¨æ¥å£å¯¹è±¡ã€‚</li><li><code>input_text_key</code>: è¾“å…¥æ­£é¢æ–‡æ¡£çš„å­—æ®µåï¼ˆé»˜è®¤ï¼š&quot;text&quot;ï¼‰ã€‚</li><li><code>input_question_key</code>: è¾“å…¥é—®é¢˜çš„å­—æ®µåï¼ˆé»˜è®¤ï¼š&quot;question&quot;ï¼‰ã€‚</li><li><code>input_scenario_key</code>: è¾“å…¥åœºæ™¯çš„å­—æ®µåï¼ˆé»˜è®¤ï¼š&quot;scenario&quot;ï¼‰ã€‚</li><li><code>input_hardneg_key</code>: è¾“å…¥å›°éš¾è´Ÿæ ·æœ¬åˆ—è¡¨çš„å­—æ®µåï¼ˆé»˜è®¤ï¼š&quot;hard_negatives&quot;ï¼‰ã€‚</li><li><code>output_key</code>: è¾“å‡ºç”Ÿæˆæ¨ç†è¿‡ç¨‹çš„å­—æ®µåï¼ˆé»˜è®¤ï¼š&quot;reasoning&quot;ï¼‰ã€‚</li></ul></li></ul><p><strong>ä½¿ç”¨ç¤ºä¾‹</strong></p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">from</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> dataflow</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">operators</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">rare </span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">import</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> RAREReasonDistillGenerator</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">reasondistill_step </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> RAREReasonDistillGenerator</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">llm_serving</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">api_llm_serving</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span>
<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">reasondistill_step</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">run</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> self</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">storage</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">step</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(),</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    input_text_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">text</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    input_question_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">question</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    input_scenario_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">scenario</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    input_hardneg_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">hard_negatives</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    output_key</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">reasoning</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,38)]))}const p=i(t,[["render",l]]),r=JSON.parse('{"path":"/zh/guide/RARE_operators/","title":"RAREç®—å­","lang":"zh-CN","frontmatter":{"title":"RAREç®—å­","createTime":"2025/09/26 11:44:42","permalink":"/zh/guide/RARE_operators/"},"readingTime":{"minutes":5.13,"words":1538},"git":{"createdTime":1750777722000,"updatedTime":1760025355000,"contributors":[{"name":"Hao Liang","username":"","email":"hao.liang@stu.pku.edu.cn","commits":1,"avatar":"https://gravatar.com/avatar/105bae3e8661728b9f2f5440992b04f5f28459b66a049d09b52213ce1438f6bc?d=retro"},{"name":"mi-iro","username":"mi-iro","email":"wzr@stu.pku.edu.cn","commits":2,"avatar":"https://avatars.githubusercontent.com/mi-iro?v=4","url":"https://github.com/mi-iro"},{"name":"Rise-1210","username":"Rise-1210","email":"risemds@163.com","commits":1,"avatar":"https://avatars.githubusercontent.com/Rise-1210?v=4","url":"https://github.com/Rise-1210"}]},"filePathRelative":"zh/notes/guide/domain_specific_operators/rare_operators.md","headers":[]}');export{p as comp,r as data};
